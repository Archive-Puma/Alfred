var Node,Nodes,Output,Path,PortScan,PyShell,calculatePath,canvas,context,createNewNode,currentModal,doubleClickTimer,getHoverNode,getNodesByExecution,getStartNodes,hideModal,options,path,reorderByZIndex,runModal,showModal;Nodes=[],(canvas=document.getElementById("canvas")).doubleclick=!1,canvas.onclick=null,canvas.onmouseup=null,canvas.onmousemove=null,(context=document.getElementById("context")).ns="http://www.w3.org/2000/svg",doubleClickTimer=300,currentModal={name:void 0,opts:void 0},reorderByZIndex=function(){var t;return t=function(t,e){return t.dom.style.zIndex>e.dom.style.zIndex},Nodes.sort(t)},getHoverNode=function(t){var e,o,n,s,d;for(o=void 0,n=Nodes.length;!o&&0!==n;)(e=Nodes[--n].dom).offsetLeft<(s=t.x)&&s<e.offsetLeft+e.offsetWidth&&e.offsetTop<(d=t.y)&&d<e.offsetTop+e.offsetHeight&&(o=Nodes[n]);return o},getStartNodes=function(){var t,e,o,n;for(n=[],t=0,e=Nodes.length;t<e;t++)0===(o=Nodes[t]).inputs.length&&n.push(o);return n},getNodesByExecution=function(){var t,e,o,n,s,d,r,a,i,u,l,p;for(e=0,p=[],(a=[]).push(getStartNodes());p.length!==Nodes.length;)for(n=e,a[++e]=[],t=0,s=(u=a[n]).length;t<s;t++)for(r=u[t],p.indexOf(r<0)&&p.push(r),o=0,d=(l=r.outputs).length;o<d;o++)i=l[o],a[e].push(i.to);return a},calculatePath=function(t,e){return"M "+t.x+" "+t.y+" L "+e.x+" "+e.y},createNewNode=function(t){var e,o;o=function(){return canvas.doubleclick=!1},canvas.doubleclick?null==(e=getHoverNode({x:t.pageX,y:t.pageY}))?(currentModal={name:"modalNewNode",opts:{x:t.pageX,y:t.pageY}},showModal(currentModal.name)):showModal(e.icon):(null!=currentModal&&hideModal(currentModal.name),canvas.doubleclick=!0,setTimeout(o,doubleClickTimer))},canvas.onclick=createNewNode,showModal=function(t){var e;null!=t&&null!=(e=document.getElementById(t))&&(e.style.bottom="20px")},hideModal=function(t){var e;null!=t&&null!=(e=document.getElementById(t))&&(e.style.bottom="-500px")},runModal=function(t,e,o){var n;return e.preventDefault(),"modalNewNode"===t&&(t=o.work.value.toLowerCase().replace(/ /g,"-"),(n=function(){switch(t){case"port-scan":return PortScan(currentModal.opts);default:return new Node(t,currentModal.opts)}}()).appendOutput().move().show(),Nodes.push(n)),hideModal(currentModal.name),!1},(Path=function(t,e){var o,n;return this.from=t,(o=this).to=e||void 0,n=function(t){return t.preventDefault(),o.destroy(),t.stopPropagation(),!1},this.coordinates={from:{x:0,y:0},to:{x:0,y:0}},this.from.parent.outputs.push(this),this.dom=document.createElementNS(context.ns,"path"),this.dom.onclick=n,this.updateCoordinatesBetweenNodes().updateRoute(),context.appendChild(this.dom),this}).prototype={getRoute:function(){return"M "+this.coordinates.from.x+" "+this.coordinates.from.y+" L "+this.coordinates.to.x+" "+this.coordinates.to.y},updateRoute:function(){return this.dom.setAttributeNS(null,"d",this.getRoute()),this},updateCoordinatesBetweenNodes:function(){return this.coordinates.from=this.from.getCoordinates(),this.coordinates.to={x:this.to?this.to.dom.offsetLeft-this.to.dom.parentElement.offsetLeft:void 0,y:this.to?this.to.dom.offsetTop+this.to.dom.offsetHeight/2-this.to.dom.parentElement.offsetTop:void 0},this},updateMouseCoordinates:function(t){return this.coordinates.to={x:t.pageX-this.from.parent.dom.parentElement.offsetLeft,y:t.pageY-this.from.parent.dom.parentElement.offsetTop},this},destroy:function(){var t,e,o,n,s,d,r,a,i;for(this.dom.removeAttributeNS(null,"d"),context.removeChild(this.dom),r=t=0,s=(a=this.from.parent.outputs).length;t<s;r=++t)e=a[r],(r=this)&&this.from.parent.outputs.splice(e,1);if(null!=this.to)for(o=n=0,d=(i=this.to.inputs).length;n<d;o=++n)e=i[o],(o.path=this)&&this.to.inputs.splice(e,1);this.from.path=void 0}},(Output=function(t){var o,e,n,s;return this.parent=t,e=function(t){return t.preventDefault(),o.path=new Path(o),canvas.onmousemove=s,canvas.onmouseup=n,t.stopPropagation(),!1},s=function(t){return t.preventDefault(),o.path.updateMouseCoordinates(t).updateRoute(),t.stopPropagation(),!1},n=function(t){var e;return t.preventDefault(),canvas.onmouseup=null,canvas.onmousemove=null,(e=getHoverNode({x:t.pageX,y:t.pageY}))?(e.inputs.push({element:o,path:o.path}),o.path.to=e,o.path.updateCoordinatesBetweenNodes().updateRoute()):o.path.destroy(),o.path=void 0,t.stopPropagation(),!1},((o=this).parent.child=this).dom=document.createElement("div"),this.dom.classList.add("output"),this.dom.onmousedown=e,this.parent.dom.appendChild(this.dom),this}).prototype={getCoordinates:function(){var t;return{x:(t=this.dom.parentElement).offsetLeft+t.offsetWidth+this.dom.offsetWidth,y:t.offsetTop+t.offsetHeight/2-t.parentElement.offsetTop}}},(Node=function(t,e){var a,o,i,n,s;return this.work=t,(a=this).pos=e||{x:0,y:0},i=function(t){var e,o,n;e={t:a.dom.style.top,l:a.dom.style.left},a.dom.offsetTop<a.dom.parentElement.offsetTop&&(a.dom.style.top=a.dom.parentElement.offsetTop+5+"px"),(o={child:a.dom.offsetTop+a.dom.offsetHeight,parent:a.dom.parentElement.offsetTop+a.dom.parentElement.offsetHeight}).parent<o.child&&(a.dom.style.top=o.parent-a.dom.offsetHeight-5+"px"),a.dom.offsetLeft<a.dom.parentElement.offsetLeft&&(a.dom.style.left=a.dom.parentElement.offsetLeft+5+"px"),(n={child:a.dom.offsetLeft+a.dom.offsetWidth,parent:a.dom.parentElement.offsetLeft+a.dom.parentElement.offsetWidth}).parent<n.child&&(a.dom.style.left=n.parent-a.dom.offsetWidth-5+"px"),a.dom.style.top===e.t&&a.dom.style.left===e.l||s(t)},o=function(t){return t.preventDefault(),a.dom.style.zIndex=Nodes.length+10,a.ppos={x:t.clientX,y:t.clientY},a.doubleclicked?a.showModalOpts():(canvas.onmousemove=n,canvas.onmouseup=s,a.doubleclicked=!0,setTimeout(function(){return a.doubleclicked=!1},doubleClickTimer)),!1},n=function(t){var e,o,n,s,d,r;for(t.preventDefault(),a.pos={x:a.ppos.x-t.clientX,y:a.ppos.y-t.clientY},a.ppos={x:t.clientX,y:t.clientY},a.dom.style.top=a.dom.offsetTop-a.pos.y+"px",a.dom.style.left=a.dom.offsetLeft-a.pos.x+"px",i(t),e=0,n=(d=a.inputs).length;e<n;e++)d[e].path.updateCoordinatesBetweenNodes().updateRoute();for(o=0,s=(r=a.outputs).length;o<s;o++)r[o].updateCoordinatesBetweenNodes().updateRoute();return t.stopPropagation(),!1},s=function(t){var e,o,n;for(t.preventDefault(),canvas.onmouseup=null,canvas.onmousemove=null,a.dom.style.zIndex=9,o=e=0,n=(Nodes=reorderByZIndex(Nodes)).length;e<n;o=++e)Nodes[o].dom.style.zIndex=o+10;return!1},this.icon=function(){switch(this.work){case"port-scan":return"sitemap";case"whois":return"radiation";default:return"file"}}.call(this),this.doubleclicked=!1,this.ppos=this.pos,this.child=void 0,this.inputs=[],this.outputs=[],this.dom=document.createElement("div"),this.dom.classList.add("node","fas","fa-"+this.icon),this.dom.style.zIndex=Nodes.length+10,this.dom.onmousedown=o,this.modal=void 0,this}).prototype={show:function(){return canvas.appendChild(this.dom),this},appendOutput:function(){return new Output(this),this},move:function(){return this.dom.style.left=this.pos.x+"px",this.dom.style.top=this.pos.y+"px",this},setModal:function(t){return this.modal=document.getElementById("modal"+t),this},showModalOpts:function(){return null!=currentModal.name&&hideModal(currentModal.name),currentModal={name:this.modal.id,opts:void 0},showModal(currentModal.name),this}},PortScan=function(t){return new Node("port-scan",t).setModal("PortScan")},path=require("path"),PyShell=require("python-shell").PythonShell,options={mode:"text",pythonOptions:["-u"],args:['{ "domain": "http://faitic.uvigo.es" }'],scriptPath:path.join(__dirname,"../backend/works/")},PyShell.run("web/robots.py",options,function(t,e){if(t)throw t;return console.log(e.join("\n"))});