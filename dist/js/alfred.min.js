var Node,Nodes,Output,Path,calculatePath,canvas,context,createNewNode,getHoverNode,getNodesByExecution,getStartNodes,hideModal,i,len,node,reorderByZIndex,showModal;for(reorderByZIndex=function(){var t;return t=function(t,e){return t.dom.style.zIndex>e.dom.style.zIndex},Nodes.sort(t)},getHoverNode=function(t){var e,o,n,s,d;for(o=void 0,n=Nodes.length;!o&&0!==n;)(e=Nodes[--n].dom).offsetLeft<(s=t.x)&&s<e.offsetLeft+e.offsetWidth&&e.offsetTop<(d=t.y)&&d<e.offsetTop+e.offsetHeight&&(o=Nodes[n]);return o},getStartNodes=function(){var t,e,o,n;for(n=[],t=0,e=Nodes.length;t<e;t++)0===(o=Nodes[t]).inputs.length&&n.push(o);return n},getNodesByExecution=function(){var t,e,o,n,s,d,i,u,a,r,p,h;for(e=0,h=[],(u=[]).push(getStartNodes());h.length!==Nodes.length;)for(n=e,u[++e]=[],t=0,s=(r=u[n]).length;t<s;t++)for(i=r[t],h.indexOf(i<0)&&h.push(i),o=0,d=(p=i.outputs).length;o<d;o++)a=p[o],u[e].push(a.to);return u},calculatePath=function(t,e){return"M "+t.x+" "+t.y+" L "+e.x+" "+e.y},createNewNode=function(t){var e;e=function(){return canvas.doubleclick=!1},canvas.doubleclick?null==getHoverNode({x:t.pageX,y:t.pageY})?prompt("Implementar nuevo nodo"):showModal():(canvas.doubleclick=!0,setTimeout(e,300))},Nodes=[],(canvas=document.getElementById("canvas")).doubleclick=!1,canvas.onclick=createNewNode,canvas.onmouseup=null,canvas.onmousemove=null,(context=document.getElementById("context")).ns="http://www.w3.org/2000/svg",(Path=function(t,e){var o,n;return this.from=t,(o=this).to=e||void 0,n=function(t){return t.preventDefault(),o.destroy(),t.stopPropagation(),!1},this.coordinates={from:{x:0,y:0},to:{x:0,y:0}},this.from.parent.outputs.push(this),this.dom=document.createElementNS(context.ns,"path"),this.dom.onclick=n,this.updateCoordinatesBetweenNodes().updateRoute(),context.appendChild(this.dom),this}).prototype={getRoute:function(){return"M "+this.coordinates.from.x+" "+this.coordinates.from.y+" L "+this.coordinates.to.x+" "+this.coordinates.to.y},updateRoute:function(){return this.dom.setAttributeNS(null,"d",this.getRoute()),this},updateCoordinatesBetweenNodes:function(){return this.coordinates.from=this.from.getCoordinates(),this.coordinates.to={x:this.to?this.to.dom.offsetLeft:void 0,y:this.to?this.to.dom.offsetTop+this.to.dom.offsetHeight/2:void 0},this},updateMouseCoordinates:function(){return this.coordinates.to={x:event.pageX,y:event.pageY},this},destroy:function(){var t,e,o,n,s,d,i,u,a;for(this.dom.removeAttributeNS(null,"d"),context.removeChild(this.dom),i=t=0,s=(u=this.from.parent.outputs).length;t<s;i=++t)e=u[i],(i=this)&&this.from.parent.outputs.splice(e,1);if(null!=this.to)for(o=n=0,d=(a=this.to.inputs).length;n<d;o=++n)e=a[o],(o.path=this)&&this.to.inputs.splice(e,1);this.from.path=void 0}},(Output=function(t){var o,e,n,s;return this.parent=t,e=function(t){return t.preventDefault(),o.path=new Path(o),canvas.onmousemove=s,canvas.onmouseup=n,t.stopPropagation(),!1},s=function(t){return t.preventDefault(),o.path.updateMouseCoordinates().updateRoute(),t.stopPropagation(),!1},n=function(t){var e;return t.preventDefault(),canvas.onmouseup=null,canvas.onmousemove=null,(e=getHoverNode({x:t.pageX,y:t.pageY}))?(e.inputs.push({element:o,path:o.path}),o.path.to=e,o.path.updateCoordinatesBetweenNodes().updateRoute()):o.path.destroy(),o.path=void 0,t.stopPropagation(),!1},((o=this).parent.child=this).dom=document.createElement("div"),this.dom.classList.add("output"),this.dom.onmousedown=e,this.parent.dom.appendChild(this.dom),this}).prototype={getCoordinates:function(){return{x:this.dom.offsetParent.offsetLeft+this.dom.offsetParent.offsetWidth+this.dom.offsetWidth,y:this.dom.offsetParent.offsetTop+this.dom.offsetParent.offsetHeight/2}}},(Node=function(t,e){var u,o,n,s;return this.icon=t,(u=this).pos=e||{x:0,y:0},o=function(t){return t.preventDefault(),u.dom.style.zIndex=Nodes.length+10,u.ppos={x:t.clientX,y:t.clientY},canvas.onmousemove=n,canvas.onmouseup=s,!1},n=function(t){var e,o,n,s,d,i;for(t.preventDefault(),u.pos={x:u.ppos.x-t.clientX,y:u.ppos.y-t.clientY},u.ppos={x:t.clientX,y:t.clientY},u.dom.style.left=u.dom.offsetLeft-u.pos.x+"px",u.dom.style.top=u.dom.offsetTop-u.pos.y+"px",e=0,n=(d=u.inputs).length;e<n;e++)d[e].path.updateCoordinatesBetweenNodes().updateRoute();for(o=0,s=(i=u.outputs).length;o<s;o++)i[o].updateCoordinatesBetweenNodes().updateRoute();return t.stopPropagation(),!1},s=function(t){var e,o,n;for(t.preventDefault(),canvas.onmouseup=null,canvas.onmousemove=null,u.dom.style.zIndex=9,o=e=0,n=(Nodes=reorderByZIndex(Nodes)).length;e<n;o=++e)Nodes[o].dom.style.zIndex=o+10;return!1},this.ppos=this.pos,this.child=void 0,this.inputs=[],this.outputs=[],this.dom=document.createElement("div"),this.dom.classList.add("node","fas","fa-"+this.icon),this.dom.style.zIndex=Nodes.length+10,this.dom.onmousedown=o,this}).prototype={show:function(){return canvas.appendChild(this.dom),this},appendOutput:function(){return new Output(this),this}},Nodes.push(new Node("sitemap")),Nodes.push(new Node("file")),Nodes.push(new Node("radiation")),i=0,len=Nodes.length;i<len;i++)(node=Nodes[i]).appendOutput().show();showModal=function(){return document.getElementById("modal").style.bottom="20px"},hideModal=function(){return document.getElementById("modal").style.bottom="-500px"};