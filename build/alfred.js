!function(p){var I=p.LiteGraph={VERSION:.4,CANVAS_GRID_SIZE:10,NODE_TITLE_HEIGHT:30,NODE_TITLE_TEXT_Y:20,NODE_SLOT_HEIGHT:20,NODE_WIDGET_HEIGHT:20,NODE_WIDTH:140,NODE_MIN_WIDTH:50,NODE_COLLAPSED_RADIUS:10,NODE_COLLAPSED_WIDTH:80,NODE_TITLE_COLOR:"#999",NODE_TEXT_SIZE:14,NODE_TEXT_COLOR:"#AAA",NODE_SUBTEXT_SIZE:12,NODE_DEFAULT_COLOR:"#333",NODE_DEFAULT_BGCOLOR:"#353535",NODE_DEFAULT_BOXCOLOR:"#666",NODE_DEFAULT_SHAPE:"box",DEFAULT_SHADOW_COLOR:"rgba(0,0,0,0.5)",DEFAULT_GROUP_FONT:24,LINK_COLOR:"#9A9",EVENT_LINK_COLOR:"#A86",CONNECTING_LINK_COLOR:"#AFA",MAX_NUMBER_OF_NODES:1e3,DEFAULT_POSITION:[100,100],VALID_SHAPES:["default","box","round","card"],BOX_SHAPE:1,ROUND_SHAPE:2,CIRCLE_SHAPE:3,CARD_SHAPE:4,ARROW_SHAPE:5,INPUT:1,OUTPUT:2,EVENT:-1,ACTION:-1,ALWAYS:0,ON_EVENT:1,NEVER:2,ON_TRIGGER:3,UP:1,DOWN:2,LEFT:3,RIGHT:4,CENTER:5,STRAIGHT_LINK:0,LINEAR_LINK:1,SPLINE_LINK:2,NORMAL_TITLE:0,NO_TITLE:1,TRANSPARENT_TITLE:2,AUTOHIDE_TITLE:3,proxy:null,node_images_path:"",debug:!1,catch_exceptions:!0,throw_errors:!0,allow_scripts:!1,registered_node_types:{},node_types_by_file_extension:{},Nodes:{},searchbox_extras:{},registerNodeType:function(t,e){if(!e.prototype)throw"Cannot register a simple object, it must be a class with a prototype";e.type=t,I.debug&&console.log("Node registered: "+t);t.split("/");var i=e.name,n=t.lastIndexOf("/");if(e.category=t.substr(0,n),e.title||(e.title=i),e.prototype)for(var s in d.prototype)e.prototype[s]||(e.prototype[s]=d.prototype[s]);Object.defineProperty(e.prototype,"shape",{set:function(t){switch(t){case"default":delete this._shape;break;case"box":this._shape=I.BOX_SHAPE;break;case"round":this._shape=I.ROUND_SHAPE;break;case"circle":this._shape=I.CIRCLE_SHAPE;break;case"card":this._shape=I.CARD_SHAPE;break;default:this._shape=t}},get:function(t){return this._shape},enumerable:!0});var o=this.registered_node_types[t];if((this.registered_node_types[t]=e).constructor.name&&(this.Nodes[i]=e),I.onNodeTypeRegistered&&I.onNodeTypeRegistered(t,e),o&&I.onNodeTypeReplaced&&I.onNodeTypeReplaced(t,e,o),e.prototype.onPropertyChange&&console.warn("LiteGraph node class "+t+" has onPropertyChange method, it must be called onPropertyChanged with d at the end"),e.supported_extensions)for(var s in e.supported_extensions)this.node_types_by_file_extension[e.supported_extensions[s].toLowerCase()]=e},wrapFunctionAsNode:function(t,i,e,n,s){for(var o=Array(i.length),r="",a=I.getParameterNames(i),l=0;l<a.length;++l)r+="this.addInput('"+a[l]+"',"+(e&&e[l]?"'"+e[l]+"'":"0")+");\n";r+="this.addOutput('out',"+(n?"'"+n+"'":0)+");\n",s&&(r+="this.properties = "+JSON.stringify(s)+";\n");var h=Function(r);h.title=t.split("/").pop(),h.desc="Generated from "+i.name,h.prototype.onExecute=function(){for(var t=0;t<o.length;++t)o[t]=this.getInputData(t);var e=i.apply(this,o);this.setOutputData(0,e)},this.registerNodeType(t,h)},addNodeMethod:function(t,e){for(var i in d.prototype[t]=e,this.registered_node_types){var n=this.registered_node_types[i];n.prototype[t]&&(n.prototype["_"+t]=n.prototype[t]),n.prototype[t]=e}},createNode:function(t,e,i){var n=this.registered_node_types[t];if(!n)return I.debug&&console.log('GraphNode type "'+t+'" not registered.'),null;n.prototype;e=e||n.title||t;var s=null;if(I.catch_exceptions)try{s=new n(e)}catch(t){return console.error(t),null}else s=new n(e);if(s.type=t,!s.title&&e&&(s.title=e),s.properties||(s.properties={}),s.properties_info||(s.properties_info=[]),s.flags||(s.flags={}),s.size||(s.size=s.computeSize()),s.pos||(s.pos=I.DEFAULT_POSITION.concat()),s.mode||(s.mode=I.ALWAYS),i)for(var o in i)s[o]=i[o];return s},getNodeType:function(t){return this.registered_node_types[t]},getNodeTypesInCategory:function(t,e){var i=[];for(var n in this.registered_node_types){var s=this.registered_node_types[n];e&&s.filter&&s.filter!=e||(""==t?null==s.category&&i.push(s):s.category==t&&i.push(s))}return i},getNodeTypesCategories:function(){var t={"":1};for(var e in this.registered_node_types)this.registered_node_types[e].category&&!this.registered_node_types[e].skip_list&&(t[this.registered_node_types[e].category]=1);var i=[];for(var e in t)i.push(e);return i},reloadNodes:function(t){var e=document.getElementsByTagName("script"),i=[];for(var n in e)i.push(e[n]);var s=document.getElementsByTagName("head")[0];for(var n in t=document.location.href+t,i){var o=i[n].src;if(o&&o.substr(0,t.length)==t)try{I.debug&&console.log("Reloading: "+o);var r=document.createElement("script");r.type="text/javascript",r.src=o,s.appendChild(r),s.removeChild(i[n])}catch(t){if(I.throw_errors)throw t;I.debug&&console.log("Error while reloading "+o)}}I.debug&&console.log("Nodes reloaded")},cloneObject:function(t,e){if(null==t)return null;var i=JSON.parse(JSON.stringify(t));if(!e)return i;for(var n in i)e[n]=i[n];return e},isValidConnection:function(t,e){if(!t||!e||t==e||t==I.EVENT&&e==I.ACTION)return!0;if(t=String(t),e=String(e),t=t.toLowerCase(),e=e.toLowerCase(),-1==t.indexOf(",")&&-1==e.indexOf(","))return t==e;for(var i=t.split(","),n=e.split(","),s=0;s<i.length;++s)for(var o=0;o<n.length;++o)if(i[s]==n[o])return!0;return!1},registerSearchboxExtra:function(t,e,i){this.searchbox_extras[e.toLowerCase()]={type:t,desc:e,data:i}}};function i(t){I.debug&&console.log("Graph created"),this.list_of_graphcanvas=null,this.clear(),t&&this.configure(t)}function c(t,e,i,n,s,o){this.id=t,this.type=e,this.origin_id=i,this.origin_slot=n,this.target_id=s,this.target_slot=o,this._data=null,this._pos=new Float32Array(2)}function d(t){this._ctor(t)}function n(t){this._ctor(t)}function s(t,e){this.offset=new Float32Array([0,0]),this.scale=1,this.max_scale=10,this.min_scale=.1,this.onredraw=null,this.enabled=!0,this.last_mouse=[0,0],this.element=null,this.visible_area=new Float32Array(4),t&&(this.element=t,e||this.bindEvents(t))}function A(t,e,i){i=i||{},this.background_image="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAGQAAABkCAIAAAD/gAIDAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAAQBJREFUeNrs1rEKwjAUhlETUkj3vP9rdmr1Ysammk2w5wdxuLgcMHyptfawuZX4pJSWZTnfnu/lnIe/jNNxHHGNn//HNbbv+4dr6V+11uF527arU7+u63qfa/bnmh8sWLBgwYJlqRf8MEptXPBXJXa37BSl3ixYsGDBMliwFLyCV/DeLIMFCxYsWLBMwSt4Be/NggXLYMGCBUvBK3iNruC9WbBgwYJlsGApeAWv4L1ZBgsWLFiwYJmCV/AK3psFC5bBggULloJX8BpdwXuzYMGCBctgwVLwCl7Be7MMFixYsGDBsu8FH1FaSmExVfAxBa/gvVmwYMGCZbBg/W4vAQYA5tRF9QYlv/QAAAAASUVORK5CYII=",t&&t.constructor===String&&(t=document.querySelector(t)),this.ds=new s,this.zoom_modify_alpha=!0,this.title_text_font=I.NODE_TEXT_SIZE+"px Arial",this.inner_text_font="normal "+I.NODE_SUBTEXT_SIZE+"px Arial",this.node_title_color=I.NODE_TITLE_COLOR,this.default_link_color=I.LINK_COLOR,this.default_connection_color={input_off:"#778",input_on:"#7F7",output_off:"#778",output_on:"#7F7"},this.highquality_render=!0,this.use_gradients=!1,this.editor_alpha=1,this.pause_rendering=!1,this.clear_background=!0,this.read_only=!1,this.render_only_selected=!0,this.live_mode=!1,this.show_info=!0,this.allow_dragcanvas=!0,this.allow_dragnodes=!0,this.allow_interaction=!0,this.allow_searchbox=!0,this.allow_reconnect_links=!1,this.drag_mode=!1,this.dragging_rectangle=null,this.filter=null,this.always_render_background=!1,this.render_shadows=!0,this.render_canvas_border=!0,this.render_connections_shadows=!1,this.render_connections_border=!0,this.render_curved_connections=!1,this.render_connection_arrows=!1,this.render_collapsed_slots=!0,this.render_execution_order=!1,this.render_title_colored=!0,this.links_render_mode=I.SPLINE_LINK,this.canvas_mouse=[0,0],this.onSearchBox=null,this.onSearchBoxSelection=null,this.onMouse=null,this.onDrawBackground=null,this.onDrawForeground=null,this.onDrawOverlay=null,this.connections_width=3,this.round_radius=8,this.current_node=null,this.node_widget=null,this.last_mouse_position=[0,0],this.visible_area=this.ds.visible_area,this.visible_links=[],e&&e.attachCanvas(this),this.setCanvas(t),this.clear(),i.skip_render||this.startRendering(),this.autoresize=i.autoresize}"undefined"!=typeof performance?I.getTime=performance.now.bind(performance):"undefined"!=typeof Date&&Date.now?I.getTime=Date.now.bind(Date):"undefined"!=typeof process?I.getTime=function(){var t=process.hrtime();return.001*t[0]+1e-6*t[1]}:I.getTime=function(){return(new Date).getTime()},p.LGraph=I.LGraph=i,i.supported_types=["number","string","boolean"],i.prototype.getSupportedTypes=function(){return this.supported_types||i.supported_types},i.STATUS_STOPPED=1,i.STATUS_RUNNING=2,i.prototype.clear=function(){if(this.stop(),this.status=i.STATUS_STOPPED,this.last_node_id=0,this.last_link_id=0,this._version=-1,this._nodes)for(var t=0;t<this._nodes.length;++t){var e=this._nodes[t];e.onRemoved&&e.onRemoved()}this._nodes=[],this._nodes_by_id={},this._nodes_in_order=[],this._nodes_executable=null,this._groups=[],this.links={},this.iteration=0,this.config={},this.globaltime=0,this.runningtime=0,this.fixedtime=0,this.fixedtime_lapse=.01,this.elapsed_time=.01,this.last_update_time=0,this.starttime=0,this.catch_errors=!0,this.inputs={},this.outputs={},this.change(),this.sendActionToCanvas("clear")},i.prototype.attachCanvas=function(t){if(t.constructor!=A)throw"attachCanvas expects a LGraphCanvas instance";t.graph&&t.graph!=this&&t.graph.detachCanvas(t),(t.graph=this).list_of_graphcanvas||(this.list_of_graphcanvas=[]),this.list_of_graphcanvas.push(t)},i.prototype.detachCanvas=function(t){if(this.list_of_graphcanvas){var e=this.list_of_graphcanvas.indexOf(t);-1!=e&&(t.graph=null,this.list_of_graphcanvas.splice(e,1))}},i.prototype.start=function(t){if(this.status!=i.STATUS_RUNNING){this.status=i.STATUS_RUNNING,this.onPlayEvent&&this.onPlayEvent(),this.sendEventToAllNodes("onStart"),this.starttime=I.getTime(),this.last_update_time=this.starttime;var e=this;if(0==(t=t||0)&&"undefined"!=typeof window&&window.requestAnimationFrame){this.execution_timer_id=-1,function t(){-1==e.execution_timer_id&&(window.requestAnimationFrame(t),e.runStep(1,!this.catch_errors))}()}else this.execution_timer_id=setInterval(function(){e.runStep(1,!this.catch_errors)},t)}},i.prototype.stop=function(){this.status!=i.STATUS_STOPPED&&(this.status=i.STATUS_STOPPED,this.onStopEvent&&this.onStopEvent(),null!=this.execution_timer_id&&(-1!=this.execution_timer_id&&clearInterval(this.execution_timer_id),this.execution_timer_id=null),this.sendEventToAllNodes("onStop"))},i.prototype.runStep=function(t,e){t=t||1;var i=I.getTime();this.globaltime=.001*(i-this.starttime);var n=this._nodes_executable?this._nodes_executable:this._nodes;if(n){if(e){for(var s=0;s<t;s++){for(var o=0,r=n.length;o<r;++o){(a=n[o]).mode==I.ALWAYS&&a.onExecute&&a.onExecute()}this.fixedtime+=this.fixedtime_lapse,this.onExecuteStep&&this.onExecuteStep()}this.onAfterExecute&&this.onAfterExecute()}else try{for(s=0;s<t;s++){for(o=0,r=n.length;o<r;++o){var a;(a=n[o]).mode==I.ALWAYS&&a.onExecute&&a.onExecute()}this.fixedtime+=this.fixedtime_lapse,this.onExecuteStep&&this.onExecuteStep()}this.onAfterExecute&&this.onAfterExecute(),this.errors_in_execution=!1}catch(t){if(this.errors_in_execution=!0,I.throw_errors)throw t;I.debug&&console.log("Error during execution: "+t),this.stop()}var l=I.getTime(),h=l-i;0==h&&(h=1),this.execution_time=.001*h,this.globaltime+=.001*h,this.iteration+=1,this.elapsed_time=.001*(l-this.last_update_time),this.last_update_time=l}},i.prototype.updateExecutionOrder=function(){this._nodes_in_order=this.computeExecutionOrder(!1),this._nodes_executable=[];for(var t=0;t<this._nodes_in_order.length;++t)this._nodes_in_order[t].onExecute&&this._nodes_executable.push(this._nodes_in_order[t])},i.prototype.computeExecutionOrder=function(t,e){for(var i=[],n=[],s={},o={},r={},a=0,l=this._nodes.length;a<l;++a){var h=this._nodes[a];if(!t||h.onExecute){var u=0;if((s[h.id]=h).inputs)for(var p=0,c=h.inputs.length;p<c;p++)h.inputs[p]&&null!=h.inputs[p].link&&(u+=1);0==u?(n.push(h),e&&(h._level=1)):(e&&(h._level=0),r[h.id]=u)}}for(;0!=n.length;){h=n.shift();if(i.push(h),delete s[h.id],h.outputs)for(a=0;a<h.outputs.length;a++){var d=h.outputs[a];if(null!=d&&null!=d.links&&0!=d.links.length)for(p=0;p<d.links.length;p++){var g=d.links[p],_=this.links[g];if(_&&!o[_.id]){var v=this.getNodeById(_.target_id);null!=v?(e&&(!v._level||v._level<=h._level)&&(v._level=h._level+1),o[_.id]=!0,r[v.id]-=1,0==r[v.id]&&n.push(v)):o[_.id]=!0}}}}for(var a in s)i.push(s[a]);i.length!=this._nodes.length&&I.debug&&console.warn("something went wrong, nodes missing");for(l=i.length,a=0;a<l;++a)i[a].order=a;i=i.sort(function(t,e){var i=t.constructor.priority||t.priority||0,n=e.constructor.priority||e.priority||0;return i==n?t.order-e.order:i-n});for(a=0;a<l;++a)i[a].order=a;return i},i.prototype.getAncestors=function(t){for(var e=[],i=[t],n={};i.length;){var s=i.shift();if(s.inputs){n[s.id]||s==t||(n[s.id]=!0,e.push(s));for(var o=0;o<s.inputs.length;++o){var r=s.getInputNode(o);r&&-1==e.indexOf(r)&&i.push(r)}}}return e.sort(function(t,e){return t.order-e.order}),e},i.prototype.arrange=function(t){t=t||40;for(var e=this.computeExecutionOrder(!1,!0),i=[],n=0;n<e.length;++n){var s=(u=e[n])._level||1;i[s]||(i[s]=[]),i[s].push(u)}var o=t;for(n=0;n<i.length;++n){var r=i[n];if(r){for(var a=100,l=t,h=0;h<r.length;++h){var u;(u=r[h]).pos[0]=o,u.pos[1]=l,u.size[0]>a&&(a=u.size[0]),l+=u.size[1]+t}o+=a+t}}this.setDirtyCanvas(!0,!0)},i.prototype.getTime=function(){return this.globaltime},i.prototype.getFixedTime=function(){return this.fixedtime},i.prototype.getElapsedTime=function(){return this.elapsed_time},i.prototype.sendEventToAllNodes=function(t,e,i){i=i||I.ALWAYS;var n=this._nodes_in_order?this._nodes_in_order:this._nodes;if(n)for(var s=0,o=n.length;s<o;++s){var r=n[s];r.constructor!==I.Subgraph||"onExecute"==t?r[t]&&r.mode==i&&(void 0===e?r[t]():e&&e.constructor===Array?r[t].apply(r,e):r[t](e)):r.mode==i&&r.sendEventToAllNodes(t,e,i)}},i.prototype.sendActionToCanvas=function(t,e){if(this.list_of_graphcanvas)for(var i=0;i<this.list_of_graphcanvas.length;++i){var n=this.list_of_graphcanvas[i];n[t]&&n[t].apply(n,e)}},i.prototype.add=function(t,e){if(t){if(t.constructor===n)return this._groups.push(t),this.setDirtyCanvas(!0),this.change(),void(t.graph=this)._version++;if(-1!=t.id&&null!=this._nodes_by_id[t.id]&&(console.warn("LiteGraph: there is already a node with this ID, changing it"),t.id=++this.last_node_id),this._nodes.length>=I.MAX_NUMBER_OF_NODES)throw"LiteGraph: max number of nodes in a graph reached";return null==t.id||-1==t.id?t.id=++this.last_node_id:this.last_node_id<t.id&&(this.last_node_id=t.id),(t.graph=this)._version++,this._nodes.push(t),(this._nodes_by_id[t.id]=t).onAdded&&t.onAdded(this),this.config.align_to_grid&&t.alignToGrid(),e||this.updateExecutionOrder(),this.onNodeAdded&&this.onNodeAdded(t),this.setDirtyCanvas(!0),this.change(),t}},i.prototype.remove=function(t){if(t.constructor===I.LGraphGroup){var e=this._groups.indexOf(t);return-1!=e&&this._groups.splice(e,1),t.graph=null,this._version++,this.setDirtyCanvas(!0,!0),void this.change()}if(null!=this._nodes_by_id[t.id]&&!t.ignore_remove){if(t.inputs)for(var i=0;i<t.inputs.length;i++){null!=(n=t.inputs[i]).link&&t.disconnectInput(i)}if(t.outputs)for(i=0;i<t.outputs.length;i++){var n;null!=(n=t.outputs[i]).links&&n.links.length&&t.disconnectOutput(i)}if(t.onRemoved&&t.onRemoved(),t.graph=null,this._version++,this.list_of_graphcanvas)for(i=0;i<this.list_of_graphcanvas.length;++i){var s=this.list_of_graphcanvas[i];s.selected_nodes[t.id]&&delete s.selected_nodes[t.id],s.node_dragged==t&&(s.node_dragged=null)}var o=this._nodes.indexOf(t);-1!=o&&this._nodes.splice(o,1),delete this._nodes_by_id[t.id],this.onNodeRemoved&&this.onNodeRemoved(t),this.setDirtyCanvas(!0,!0),this.change(),this.updateExecutionOrder()}},i.prototype.getNodeById=function(t){return null==t?null:this._nodes_by_id[t]},i.prototype.findNodesByClass=function(t,e){for(var i=(e=e||[]).length=0,n=this._nodes.length;i<n;++i)this._nodes[i].constructor===t&&e.push(this._nodes[i]);return e},i.prototype.findNodesByType=function(t,e){t=t.toLowerCase();for(var i=(e=e||[]).length=0,n=this._nodes.length;i<n;++i)this._nodes[i].type.toLowerCase()==t&&e.push(this._nodes[i]);return e},i.prototype.findNodeByTitle=function(t){for(var e=0,i=this._nodes.length;e<i;++e)if(this._nodes[e].title==t)return this._nodes[e];return null},i.prototype.findNodesByTitle=function(t){for(var e=[],i=0,n=this._nodes.length;i<n;++i)this._nodes[i].title==t&&e.push(this._nodes[i]);return e},i.prototype.getNodeOnPos=function(t,e,i,n){for(var s=(i=i||this._nodes).length-1;0<=s;s--){var o=i[s];if(o.isPointInside(t,e,n))return o}return null},i.prototype.getGroupOnPos=function(t,e){for(var i=this._groups.length-1;0<=i;i--){var n=this._groups[i];if(n.isPointInside(t,e,2,!0))return n}return null},i.prototype.checkNodeTypes=function(){for(var t=0;t<this._nodes.length;t++){var e=this._nodes[t],i=I.registered_node_types[e.type];if(e.constructor!=i){console.log("node being replaced by newer version: "+e.type);var n=I.createNode(e.type);!0,(this._nodes[t]=n).configure(e.serialize()),(n.graph=this)._nodes_by_id[n.id]=n,e.inputs&&(n.inputs=e.inputs.concat()),e.outputs&&(n.outputs=e.outputs.concat())}}this.updateExecutionOrder()},i.prototype.onAction=function(t,e){this._input_nodes=this.findNodesByClass(I.GraphInput,this._input_nodes);for(var i=0;i<this._input_nodes.length;++i){var n=this._input_nodes[i];if(n.properties.name==t){n.onAction(t,e);break}}},i.prototype.trigger=function(t,e){this.onTrigger&&this.onTrigger(t,e)},i.prototype.addInput=function(t,e,i){this.inputs[t]||(this.inputs[t]={name:t,type:e,value:i},this._version++,this.onInputAdded&&this.onInputAdded(t,e),this.onInputsOutputsChange&&this.onInputsOutputsChange())},i.prototype.setInputData=function(t,e){var i=this.inputs[t];i&&(i.value=e)},i.prototype.getInputData=function(t){var e=this.inputs[t];return e?e.value:null},i.prototype.renameInput=function(t,e){if(e!=t){if(!this.inputs[t])return!1;if(this.inputs[e])return console.error("there is already one input with that name"),!1;this.inputs[e]=this.inputs[t],delete this.inputs[t],this._version++,this.onInputRenamed&&this.onInputRenamed(t,e),this.onInputsOutputsChange&&this.onInputsOutputsChange()}},i.prototype.changeInputType=function(t,e){if(!this.inputs[t])return!1;this.inputs[t].type&&String(this.inputs[t].type).toLowerCase()==String(e).toLowerCase()||(this.inputs[t].type=e,this._version++,this.onInputTypeChanged&&this.onInputTypeChanged(t,e))},i.prototype.removeInput=function(t){return!!this.inputs[t]&&(delete this.inputs[t],this._version++,this.onInputRemoved&&this.onInputRemoved(t),this.onInputsOutputsChange&&this.onInputsOutputsChange(),!0)},i.prototype.addOutput=function(t,e,i){this.outputs[t]={name:t,type:e,value:i},this._version++,this.onOutputAdded&&this.onOutputAdded(t,e),this.onInputsOutputsChange&&this.onInputsOutputsChange()},i.prototype.setOutputData=function(t,e){var i=this.outputs[t];i&&(i.value=e)},i.prototype.getOutputData=function(t){var e=this.outputs[t];return e?e.value:null},i.prototype.renameOutput=function(t,e){return!!this.outputs[t]&&(this.outputs[e]?(console.error("there is already one output with that name"),!1):(this.outputs[e]=this.outputs[t],delete this.outputs[t],this._version++,this.onOutputRenamed&&this.onOutputRenamed(t,e),void(this.onInputsOutputsChange&&this.onInputsOutputsChange())))},i.prototype.changeOutputType=function(t,e){if(!this.outputs[t])return!1;this.outputs[t].type&&String(this.outputs[t].type).toLowerCase()==String(e).toLowerCase()||(this.outputs[t].type=e,this._version++,this.onOutputTypeChanged&&this.onOutputTypeChanged(t,e))},i.prototype.removeOutput=function(t){return!!this.outputs[t]&&(delete this.outputs[t],this._version++,this.onOutputRemoved&&this.onOutputRemoved(t),this.onInputsOutputsChange&&this.onInputsOutputsChange(),!0)},i.prototype.triggerInput=function(t,e){for(var i=this.findNodesByTitle(t),n=0;n<i.length;++n)i[n].onTrigger(e)},i.prototype.setCallback=function(t,e){for(var i=this.findNodesByTitle(t),n=0;n<i.length;++n)i[n].setTrigger(e)},i.prototype.connectionChange=function(t,e){this.updateExecutionOrder(),this.onConnectionChange&&this.onConnectionChange(t),this._version++,this.sendActionToCanvas("onConnectionChange")},i.prototype.isLive=function(){if(!this.list_of_graphcanvas)return!1;for(var t=0;t<this.list_of_graphcanvas.length;++t){if(this.list_of_graphcanvas[t].live_mode)return!0}return!1},i.prototype.clearTriggeredSlots=function(){for(var t in this.links){var e=this.links[t];e&&e._last_time&&(e._last_time=0)}},i.prototype.change=function(){I.debug&&console.log("Graph changed"),this.sendActionToCanvas("setDirty",[!0,!0]),this.on_change&&this.on_change(this)},i.prototype.setDirtyCanvas=function(t,e){this.sendActionToCanvas("setDirty",[t,e])},i.prototype.removeLink=function(t){var e=this.links[t];if(e){var i=this.getNodeById(e.target_id);i&&i.disconnectInput(e.target_slot)}},i.prototype.serialize=function(){for(var t=[],e=0,i=this._nodes.length;e<i;++e)t.push(this._nodes[e].serialize());var n=[];for(var e in this.links){var s=this.links[e];if(!s.serialize){console.warn("weird LLink bug, link info is not a LLink but a regular object");var o=new c;for(var e in s)o[e]=s[e];s=this.links[e]=o}n.push(s.serialize())}var r=[];for(e=0;e<this._groups.length;++e)r.push(this._groups[e].serialize());return{last_node_id:this.last_node_id,last_link_id:this.last_link_id,nodes:t,links:n,groups:r,config:this.config,version:I.VERSION}},i.prototype.configure=function(t,e){if(t){e||this.clear();var i=t.nodes;if(t.links&&t.links.constructor===Array){for(var n=[],s=0;s<t.links.length;++s){var o=t.links[s],r=new c;r.configure(o),n[r.id]=r}t.links=n}for(var s in t)this[s]=t[s];var a=!1;if(this._nodes=[],i){s=0;for(var l=i.length;s<l;++s){var h=i[s];(u=I.createNode(h.type,h.title))||(I.debug&&console.log("Node not found or has errors: "+h.type),(u=new d).last_serialization=h,a=u.has_errors=!0),u.id=h.id,this.add(u,!0)}for(s=0,l=i.length;s<l;++s){var u;h=i[s];(u=this.getNodeById(h.id))&&u.configure(h)}}if(this._groups.length=0,t.groups)for(s=0;s<t.groups.length;++s){var p=new I.LGraphGroup;p.configure(t.groups[s]),this.add(p)}return this.updateExecutionOrder(),this._version++,this.setDirtyCanvas(!0,!0),a}},i.prototype.load=function(t){var i=this,n=new XMLHttpRequest;n.open("GET",t,!0),n.send(null),n.onload=function(t){if(200===n.status){var e=JSON.parse(n.response);i.configure(e)}else console.error("Error loading graph:",n.status,n.response)},n.onerror=function(t){console.error("Error loading graph:",t)}},i.prototype.onNodeTrace=function(t,e,i){},c.prototype.configure=function(t){t.constructor===Array?(this.id=t[0],this.origin_id=t[1],this.origin_slot=t[2],this.target_id=t[3],this.target_slot=t[4],this.type=t[5]):(this.id=t.id,this.type=t.type,this.origin_id=t.origin_id,this.origin_slot=t.origin_slot,this.target_id=t.target_id,this.target_slot=t.target_slot)},c.prototype.serialize=function(){return[this.id,this.origin_id,this.origin_slot,this.target_id,this.target_slot,this.type]},I.LLink=c,p.LGraphNode=I.LGraphNode=d,d.prototype._ctor=function(t){this.title=t||"Unnamed",this.size=[I.NODE_WIDTH,60],this.graph=null,this._pos=new Float32Array(10,10),Object.defineProperty(this,"pos",{set:function(t){!t||t.length<2||(this._pos[0]=t[0],this._pos[1]=t[1])},get:function(){return this._pos},enumerable:!0}),this.id=-1,this.type=null,this.inputs=[],this.outputs=[],this.connections=[],this.properties={},this.properties_info=[],this.flags={}},d.prototype.configure=function(t){for(var e in this.graph&&this.graph._version++,t)if("properties"!=e)null!=t[e]&&("object"==typeof t[e]?this[e]&&this[e].configure?this[e].configure(t[e]):this[e]=I.cloneObject(t[e],this[e]):this[e]=t[e]);else for(var i in t.properties)this.properties[i]=t.properties[i],this.onPropertyChanged&&this.onPropertyChanged(i,t.properties[i]);if(t.title||(this.title=this.constructor.title),this.onConnectionsChange){if(this.inputs)for(var n=0;n<this.inputs.length;++n){var s=this.inputs[n],o=this.graph?this.graph.links[s.link]:null;this.onConnectionsChange(I.INPUT,n,!0,o,s)}if(this.outputs)for(n=0;n<this.outputs.length;++n){var r=this.outputs[n];if(r.links)for(e=0;e<r.links.length;++e){o=this.graph?this.graph.links[r.links[e]]:null;this.onConnectionsChange(I.OUTPUT,n,!0,o,r)}}}if(t.widgets_values&&this.widgets)for(n=0;n<t.widgets_values.length;++n)this.widgets[n]&&(this.widgets[n].value=t.widgets_values[n]);this.onConfigure&&this.onConfigure(t)},d.prototype.serialize=function(){var t={id:this.id,type:this.type,pos:this.pos,size:this.size,flags:I.cloneObject(this.flags),mode:this.mode};if(this.constructor===d&&this.last_serialization)return this.last_serialization;if(this.inputs&&(t.inputs=this.inputs),this.outputs){for(var e=0;e<this.outputs.length;e++)delete this.outputs[e]._data;t.outputs=this.outputs}if(this.title&&this.title!=this.constructor.title&&(t.title=this.title),this.properties&&(t.properties=I.cloneObject(this.properties)),this.widgets&&this.serialize_widgets){t.widgets_values=[];for(e=0;e<this.widgets.length;++e)t.widgets_values[e]=this.widgets[e].value}return t.type||(t.type=this.constructor.type),this.color&&(t.color=this.color),this.bgcolor&&(t.bgcolor=this.bgcolor),this.boxcolor&&(t.boxcolor=this.boxcolor),this.shape&&(t.shape=this.shape),this.onSerialize&&this.onSerialize(t)&&console.warn("node onSerialize shouldnt return anything, data should be stored in the object pass in the first parameter"),t},d.prototype.clone=function(){var t=I.createNode(this.type);if(!t)return null;var e=I.cloneObject(this.serialize());if(e.inputs)for(var i=0;i<e.inputs.length;++i)e.inputs[i].link=null;if(e.outputs)for(i=0;i<e.outputs.length;++i)e.outputs[i].links&&(e.outputs[i].links.length=0);return delete e.id,t.configure(e),t},d.prototype.toString=function(){return JSON.stringify(this.serialize())},d.prototype.getTitle=function(){return this.title||this.constructor.title},d.prototype.setProperty=function(t,e){this.properties||(this.properties={}),this.properties[t]=e,this.onPropertyChanged&&this.onPropertyChanged(t,e)},d.prototype.setOutputData=function(t,e){if(this.outputs&&!(-1==t||t>=this.outputs.length)){var i=this.outputs[t];if(i&&(i._data=e,this.outputs[t].links))for(var n=0;n<this.outputs[t].links.length;n++){var s=this.outputs[t].links[n];this.graph.links[s].data=e}}},d.prototype.setOutputDataType=function(t,e){if(this.outputs&&!(-1==t||t>=this.outputs.length)){var i=this.outputs[t];if(i&&(i.type=e,this.outputs[t].links))for(var n=0;n<this.outputs[t].links.length;n++){var s=this.outputs[t].links[n];this.graph.links[s].type=e}}},d.prototype.getInputData=function(t,e){if(this.inputs&&!(t>=this.inputs.length||null==this.inputs[t].link)){var i=this.inputs[t].link,n=this.graph.links[i];if(!n)return null;if(!e)return n.data;var s=this.graph.getNodeById(n.origin_id);return s&&(s.updateOutputData?s.updateOutputData(n.origin_slot):s.onExecute&&s.onExecute()),n.data}},d.prototype.getInputDataType=function(t){if(!this.inputs)return null;if(t>=this.inputs.length||null==this.inputs[t].link)return null;var e=this.inputs[t].link,i=this.graph.links[e];if(!i)return null;var n=this.graph.getNodeById(i.origin_id);if(!n)return i.type;var s=n.outputs[i.origin_slot];return s?s.type:null},d.prototype.getInputDataByName=function(t,e){var i=this.findInputSlot(t);return-1==i?null:this.getInputData(i,e)},d.prototype.isInputConnected=function(t){return!!this.inputs&&(t<this.inputs.length&&null!=this.inputs[t].link)},d.prototype.getInputInfo=function(t){return this.inputs&&t<this.inputs.length?this.inputs[t]:null},d.prototype.getInputNode=function(t){if(!this.inputs)return null;if(t>=this.inputs.length)return null;var e=this.inputs[t];if(!e||null===e.link)return null;var i=this.graph.links[e.link];return i?this.graph.getNodeById(i.origin_id):null},d.prototype.getInputOrProperty=function(t){if(!this.inputs||!this.inputs.length)return this.properties?this.properties[t]:null;for(var e=0,i=this.inputs.length;e<i;++e){var n=this.inputs[e];if(t==n.name&&null!=n.link){var s=this.graph.links[n.link];if(s)return s.data}}return this.properties[t]},d.prototype.getOutputData=function(t){return this.outputs?t>=this.outputs.length?null:this.outputs[t]._data:null},d.prototype.getOutputInfo=function(t){return this.outputs&&t<this.outputs.length?this.outputs[t]:null},d.prototype.isOutputConnected=function(t){return!!this.outputs&&(t<this.outputs.length&&this.outputs[t].links&&this.outputs[t].links.length)},d.prototype.isAnyOutputConnected=function(){if(!this.outputs)return!1;for(var t=0;t<this.outputs.length;++t)if(this.outputs[t].links&&this.outputs[t].links.length)return!0;return!1},d.prototype.getOutputNodes=function(t){if(!this.outputs||0==this.outputs.length)return null;if(t>=this.outputs.length)return null;var e=this.outputs[t];if(!e.links||0==e.links.length)return null;for(var i=[],n=0;n<e.links.length;n++){var s=e.links[n],o=this.graph.links[s];if(o){var r=this.graph.getNodeById(o.target_id);r&&i.push(r)}}return i},d.prototype.trigger=function(t,e){if(this.outputs&&this.outputs.length){this.graph&&(this.graph._last_trigger_time=I.getTime());for(var i=0;i<this.outputs.length;++i){var n=this.outputs[i];!n||n.type!==I.EVENT||t&&n.name!=t||this.triggerSlot(i,e)}}},d.prototype.triggerSlot=function(t,e,i){if(this.outputs){var n=this.outputs[t];if(n){var s=n.links;if(s&&s.length){this.graph&&(this.graph._last_trigger_time=I.getTime());for(var o=0;o<s.length;++o){var r=s[o];if(null==i||i==r){var a=this.graph.links[s[o]];if(a){a._last_time=I.getTime();var l=this.graph.getNodeById(a.target_id);if(l){var h=l.inputs[a.target_slot];l.onAction?l.onAction(h.name,e):l.mode===I.ON_TRIGGER&&l.onExecute&&l.onExecute(e)}}}}}}}},d.prototype.clearTriggeredSlot=function(t,e){if(this.outputs){var i=this.outputs[t];if(i){var n=i.links;if(n&&n.length)for(var s=0;s<n.length;++s){var o=n[s];if(null==e||e==o){var r=this.graph.links[n[s]];r&&(r._last_time=0)}}}}},d.prototype.addProperty=function(t,e,i,n){var s={name:t,type:i,default_value:e};if(n)for(var o in n)s[o]=n[o];return this.properties_info||(this.properties_info=[]),this.properties_info.push(s),this.properties||(this.properties={}),this.properties[t]=e,s},d.prototype.addOutput=function(t,e,i){var n={name:t,type:e,links:null};if(i)for(var s in i)n[s]=i[s];return this.outputs||(this.outputs=[]),this.outputs.push(n),this.onOutputAdded&&this.onOutputAdded(n),this.size=this.computeSize(),this.setDirtyCanvas(!0,!0),n},d.prototype.addOutputs=function(t){for(var e=0;e<t.length;++e){var i=t[e],n={name:i[0],type:i[1],link:null};if(t[2])for(var s in i[2])n[s]=i[2][s];this.outputs||(this.outputs=[]),this.outputs.push(n),this.onOutputAdded&&this.onOutputAdded(n)}this.size=this.computeSize(),this.setDirtyCanvas(!0,!0)},d.prototype.removeOutput=function(t){this.disconnectOutput(t),this.outputs.splice(t,1);for(var e=t;e<this.outputs.length;++e)if(this.outputs[e]&&this.outputs[e].links)for(var i=this.outputs[e].links,n=0;n<i.length;++n){var s=this.graph.links[i[n]];s&&(s.origin_slot-=1)}this.size=this.computeSize(),this.onOutputRemoved&&this.onOutputRemoved(t),this.setDirtyCanvas(!0,!0)},d.prototype.addInput=function(t,e,i){var n={name:t,type:e=e||0,link:null};if(i)for(var s in i)n[s]=i[s];return this.inputs||(this.inputs=[]),this.inputs.push(n),this.size=this.computeSize(),this.onInputAdded&&this.onInputAdded(n),this.setDirtyCanvas(!0,!0),n},d.prototype.addInputs=function(t){for(var e=0;e<t.length;++e){var i=t[e],n={name:i[0],type:i[1],link:null};if(t[2])for(var s in i[2])n[s]=i[2][s];this.inputs||(this.inputs=[]),this.inputs.push(n),this.onInputAdded&&this.onInputAdded(n)}this.size=this.computeSize(),this.setDirtyCanvas(!0,!0)},d.prototype.removeInput=function(t){this.disconnectInput(t),this.inputs.splice(t,1);for(var e=t;e<this.inputs.length;++e)if(this.inputs[e]){var i=this.graph.links[this.inputs[e].link];i&&(i.target_slot-=1)}this.size=this.computeSize(),this.onInputRemoved&&this.onInputRemoved(t),this.setDirtyCanvas(!0,!0)},d.prototype.addConnection=function(t,e,i,n){var s={name:t,type:e,pos:i,direction:n,links:null};return this.connections.push(s),s},d.prototype.computeSize=function(t,e){if(this.constructor.size)return this.constructor.size.concat();var i=Math.max(this.inputs?this.inputs.length:1,this.outputs?this.outputs.length:1),n=e||new Float32Array([0,0]);i=Math.max(i,1);var s=I.NODE_TEXT_SIZE;n[1]=(this.constructor.slot_start_y||0)+i*I.NODE_SLOT_HEIGHT;var o=0;this.widgets&&this.widgets.length&&(o=this.widgets.length*(I.NODE_WIDGET_HEIGHT+4)+8),this.widgets_up?n[1]=Math.max(n[1],o):n[1]+=o;s=s;var r=g(this.title),a=0,l=0;if(this.inputs)for(var h=0,u=this.inputs.length;h<u;++h){var p=this.inputs[h];a<(c=g(p.label||p.name||""))&&(a=c)}if(this.outputs)for(h=0,u=this.outputs.length;h<u;++h){var c,d=this.outputs[h];l<(c=g(d.label||d.name||""))&&(l=c)}function g(t){return t?s*t.length*.6:0}return n[0]=Math.max(a+l+10,r),n[0]=Math.max(n[0],I.NODE_WIDTH),this.widgets&&this.widgets.length&&(n[0]=Math.max(n[0],1.5*I.NODE_WIDTH)),this.onResize&&this.onResize(n),this.constructor.min_height&&n[1]<this.constructor.min_height&&(n[1]=this.constructor.min_height),n[1]+=6,n},d.prototype.addWidget=function(t,e,i,n,s){this.widgets||(this.widgets=[]);var o={type:t.toLowerCase(),name:e,value:i,callback:n,options:s||{}};if(void 0!==o.options.y&&(o.y=o.options.y),n||console.warn("LiteGraph addWidget(...) without a callback"),"combo"==t&&!o.options.values)throw"LiteGraph addWidget('combo',...) requires to pass values in options: { values:['red','blue'] }";return this.widgets.push(o),o},d.prototype.addCustomWidget=function(t){return this.widgets||(this.widgets=[]),this.widgets.push(t),t},d.prototype.getBounding=function(t){return(t=t||new Float32Array(4))[0]=this.pos[0]-4,t[1]=this.pos[1]-I.NODE_TITLE_HEIGHT,t[2]=this.size[0]+4,t[3]=this.size[1]+I.NODE_TITLE_HEIGHT,this.onBounding&&this.onBounding(t),t},d.prototype.isPointInside=function(t,e,i,n){i=i||0;var s=this.graph&&this.graph.isLive()?0:I.NODE_TITLE_HEIGHT;if(n&&(s=0),this.flags&&this.flags.collapsed){if(v(t,e,this.pos[0]-i,this.pos[1]-I.NODE_TITLE_HEIGHT-i,(this._collapsed_width||I.NODE_COLLAPSED_WIDTH)+2*i,I.NODE_TITLE_HEIGHT+2*i))return!0}else if(this.pos[0]-4-i<t&&this.pos[0]+this.size[0]+4+i>t&&this.pos[1]-s-i<e&&this.pos[1]+this.size[1]+i>e)return!0;return!1},d.prototype.getSlotInPosition=function(t,e){var i=new Float32Array(2);if(this.inputs)for(var n=0,s=this.inputs.length;n<s;++n){var o=this.inputs[n];if(this.getConnectionPos(!0,n,i),v(t,e,i[0]-10,i[1]-5,20,10))return{input:o,slot:n,link_pos:i}}if(this.outputs)for(n=0,s=this.outputs.length;n<s;++n){var r=this.outputs[n];if(this.getConnectionPos(!1,n,i),v(t,e,i[0]-10,i[1]-5,20,10))return{output:r,slot:n,link_pos:i}}return null},d.prototype.findInputSlot=function(t){if(!this.inputs)return-1;for(var e=0,i=this.inputs.length;e<i;++e)if(t==this.inputs[e].name)return e;return-1},d.prototype.findOutputSlot=function(t){if(!this.outputs)return-1;for(var e=0,i=this.outputs.length;e<i;++e)if(t==this.outputs[e].name)return e;return-1},d.prototype.connect=function(t,e,i){if(i=i||0,!this.graph)return console.log("Connect: Error, node doesn't belong to any graph. Nodes must be added first to a graph before connecting them."),null;if(t.constructor===String){if(-1==(t=this.findOutputSlot(t)))return I.debug&&console.log("Connect: Error, no slot of name "+t),null}else if(!this.outputs||t>=this.outputs.length)return I.debug&&console.log("Connect: Error, slot number not found"),null;if(e&&e.constructor===Number&&(e=this.graph.getNodeById(e)),!e)throw"target node is null";if(e==this)return null;if(i.constructor===String){if(-1==(i=e.findInputSlot(i)))return I.debug&&console.log("Connect: Error, no slot of name "+i),null}else{if(i===I.EVENT)return null;if(!e.inputs||i>=e.inputs.length)return I.debug&&console.log("Connect: Error, slot number not found"),null}null!=e.inputs[i].link&&e.disconnectInput(i);var n=this.outputs[t];if(e.onConnectInput&&!1===e.onConnectInput(i,n.type,n))return null;var s=e.inputs[i],o=null;return I.isValidConnection(n.type,s.type)&&(o=new c(this.graph.last_link_id++,s.type,this.id,t,e.id,i),this.graph.links[o.id]=o,null==n.links&&(n.links=[]),n.links.push(o.id),e.inputs[i].link=o.id,this.graph&&this.graph._version++,this.onConnectionsChange&&this.onConnectionsChange(I.OUTPUT,t,!0,o,n),e.onConnectionsChange&&e.onConnectionsChange(I.INPUT,i,!0,o,s),this.graph&&this.graph.onNodeConnectionChange&&(this.graph.onNodeConnectionChange(I.INPUT,e,i,this,t),this.graph.onNodeConnectionChange(I.OUTPUT,this,t,e,i))),this.setDirtyCanvas(!1,!0),this.graph.connectionChange(this,o),o},d.prototype.disconnectOutput=function(t,e){if(t.constructor===String){if(-1==(t=this.findOutputSlot(t)))return I.debug&&console.log("Connect: Error, no slot of name "+t),!1}else if(!this.outputs||t>=this.outputs.length)return I.debug&&console.log("Connect: Error, slot number not found"),!1;var i=this.outputs[t];if(!i||!i.links||0==i.links.length)return!1;if(e){if(e.constructor===Number&&(e=this.graph.getNodeById(e)),!e)throw"Target Node not found";for(var n=0,s=i.links.length;n<s;n++){var o=i.links[n];if((r=this.graph.links[o]).target_id==e.id){i.links.splice(n,1),(a=e.inputs[r.target_slot]).link=null,delete this.graph.links[o],this.graph&&this.graph._version++,e.onConnectionsChange&&e.onConnectionsChange(I.INPUT,r.target_slot,!1,r,a),this.onConnectionsChange&&this.onConnectionsChange(I.OUTPUT,t,!1,r,i),this.graph&&this.graph.onNodeConnectionChange&&this.graph.onNodeConnectionChange(I.OUTPUT,this,t),this.graph&&this.graph.onNodeConnectionChange&&(this.graph.onNodeConnectionChange(I.OUTPUT,this,t),this.graph.onNodeConnectionChange(I.INPUT,e,r.target_slot));break}}}else{for(n=0,s=i.links.length;n<s;n++){var r;o=i.links[n];if(r=this.graph.links[o]){e=this.graph.getNodeById(r.target_id);var a=null;this.graph&&this.graph._version++,e&&((a=e.inputs[r.target_slot]).link=null,e.onConnectionsChange&&e.onConnectionsChange(I.INPUT,r.target_slot,!1,r,a),this.graph&&this.graph.onNodeConnectionChange&&this.graph.onNodeConnectionChange(I.INPUT,e,r.target_slot)),delete this.graph.links[o],this.onConnectionsChange&&this.onConnectionsChange(I.OUTPUT,t,!1,r,i),this.graph&&this.graph.onNodeConnectionChange&&(this.graph.onNodeConnectionChange(I.OUTPUT,this,t),this.graph.onNodeConnectionChange(I.INPUT,e,r.target_slot))}}i.links=null}return this.setDirtyCanvas(!1,!0),this.graph.connectionChange(this),!0},d.prototype.disconnectInput=function(t){if(t.constructor===String){if(-1==(t=this.findInputSlot(t)))return I.debug&&console.log("Connect: Error, no slot of name "+t),!1}else if(!this.inputs||t>=this.inputs.length)return I.debug&&console.log("Connect: Error, slot number not found"),!1;var e=this.inputs[t];if(!e)return!1;var i=this.inputs[t].link;this.inputs[t].link=null;var n=this.graph.links[i];if(n){var s=this.graph.getNodeById(n.origin_id);if(!s)return!1;var o=s.outputs[n.origin_slot];if(!o||!o.links||0==o.links.length)return!1;for(var r=0,a=o.links.length;r<a;r++)if(o.links[r]==i){o.links.splice(r,1);break}delete this.graph.links[i],this.graph&&this.graph._version++,this.onConnectionsChange&&this.onConnectionsChange(I.INPUT,t,!1,n,e),s.onConnectionsChange&&s.onConnectionsChange(I.OUTPUT,r,!1,n,o),this.graph&&this.graph.onNodeConnectionChange&&(this.graph.onNodeConnectionChange(I.OUTPUT,s,r),this.graph.onNodeConnectionChange(I.INPUT,this,t))}return this.setDirtyCanvas(!1,!0),this.graph.connectionChange(this),!0},d.prototype.getConnectionPos=function(t,e,i){i=i||new Float32Array(2);var n=0;t&&this.inputs&&(n=this.inputs.length),!t&&this.outputs&&(n=this.outputs.length);var s=.5*I.NODE_SLOT_HEIGHT;if(this.flags.collapsed){var o=this._collapsed_width||I.NODE_COLLAPSED_WIDTH;return this.horizontal?(i[0]=this.pos[0]+.5*o,i[1]=t?this.pos[1]-I.NODE_TITLE_HEIGHT:this.pos[1]):(i[0]=t?this.pos[0]:this.pos[0]+o,i[1]=this.pos[1]-.5*I.NODE_TITLE_HEIGHT),i}return t&&-1==e?(i[0]=this.pos[0]+.5*I.NODE_TITLE_HEIGHT,i[1]=this.pos[1]+.5*I.NODE_TITLE_HEIGHT):t&&e<n&&this.inputs[e].pos?(i[0]=this.pos[0]+this.inputs[e].pos[0],i[1]=this.pos[1]+this.inputs[e].pos[1]):!t&&e<n&&this.outputs[e].pos?(i[0]=this.pos[0]+this.outputs[e].pos[0],i[1]=this.pos[1]+this.outputs[e].pos[1]):this.horizontal?(i[0]=this.pos[0]+(e+.5)*(this.size[0]/n),i[1]=t?this.pos[1]-I.NODE_TITLE_HEIGHT:this.pos[1]+this.size[1]):(i[0]=t?this.pos[0]+s:this.pos[0]+this.size[0]+1-s,i[1]=this.pos[1]+(e+.7)*I.NODE_SLOT_HEIGHT+(this.constructor.slot_start_y||0)),i},d.prototype.alignToGrid=function(){this.pos[0]=I.CANVAS_GRID_SIZE*Math.round(this.pos[0]/I.CANVAS_GRID_SIZE),this.pos[1]=I.CANVAS_GRID_SIZE*Math.round(this.pos[1]/I.CANVAS_GRID_SIZE)},d.prototype.trace=function(t){this.console||(this.console=[]),this.console.push(t),this.console.length>d.MAX_CONSOLE&&this.console.shift(),this.graph.onNodeTrace(this,t)},d.prototype.setDirtyCanvas=function(t,e){this.graph&&this.graph.sendActionToCanvas("setDirty",[t,e])},d.prototype.loadImage=function(t){var e=new Image;e.src=I.node_images_path+t,e.ready=!1;var i=this;return e.onload=function(){this.ready=!0,i.setDirtyCanvas(!0)},e},d.prototype.captureInput=function(t){if(this.graph&&this.graph.list_of_graphcanvas)for(var e=this.graph.list_of_graphcanvas,i=0;i<e.length;++i){var n=e[i];!t&&n.node_capturing_input!=this||(n.node_capturing_input=t?this:null)}},d.prototype.collapse=function(t){this.graph._version++,!1===this.constructor.collapsable&&!t||(this.flags.collapsed?this.flags.collapsed=!1:this.flags.collapsed=!0,this.setDirtyCanvas(!0,!0))},d.prototype.pin=function(t){this.graph._version++,this.flags.pinned=void 0===t?!this.flags.pinned:t},d.prototype.localToScreen=function(t,e,i){return[(t+this.pos[0])*i.scale+i.offset[0],(e+this.pos[1])*i.scale+i.offset[1]]},p.LGraphGroup=I.LGraphGroup=n,n.prototype._ctor=function(t){this.title=t||"Group",this.font_size=24,this.color=A.node_colors.pale_blue?A.node_colors.pale_blue.groupcolor:"#AAA",this._bounding=new Float32Array([10,10,140,80]),this._pos=this._bounding.subarray(0,2),this._size=this._bounding.subarray(2,4),this._nodes=[],this.graph=null,Object.defineProperty(this,"pos",{set:function(t){!t||t.length<2||(this._pos[0]=t[0],this._pos[1]=t[1])},get:function(){return this._pos},enumerable:!0}),Object.defineProperty(this,"size",{set:function(t){!t||t.length<2||(this._size[0]=Math.max(140,t[0]),this._size[1]=Math.max(80,t[1]))},get:function(){return this._size},enumerable:!0})},n.prototype.configure=function(t){this.title=t.title,this._bounding.set(t.bounding),this.color=t.color,this.font=t.font},n.prototype.serialize=function(){var t=this._bounding;return{title:this.title,bounding:[Math.round(t[0]),Math.round(t[1]),Math.round(t[2]),Math.round(t[3])],color:this.color,font:this.font}},n.prototype.move=function(t,e,i){if(this._pos[0]+=t,this._pos[1]+=e,!i)for(var n=0;n<this._nodes.length;++n){var s=this._nodes[n];s.pos[0]+=t,s.pos[1]+=e}},n.prototype.recomputeInsideNodes=function(){this._nodes.length=0;for(var t=this.graph._nodes,e=new Float32Array(4),i=0;i<t.length;++i){var n=t[i];n.getBounding(e),w(this._bounding,e)&&this._nodes.push(n)}},n.prototype.isPointInside=d.prototype.isPointInside,n.prototype.setDirtyCanvas=d.prototype.setDirtyCanvas,(I.DragAndScale=s).prototype.bindEvents=function(t){this.last_mouse=new Float32Array(2),this._binded_mouse_callback=this.onMouse.bind(this),t.addEventListener("mousedown",this._binded_mouse_callback),t.addEventListener("mousemove",this._binded_mouse_callback),t.addEventListener("mousewheel",this._binded_mouse_callback,!1),t.addEventListener("wheel",this._binded_mouse_callback,!1)},s.prototype.computeVisibleArea=function(){if(this.element){var t=this.element.width,e=this.element.height,i=-this.offset[0],n=-this.offset[1],s=i+t/this.scale,o=n+e/this.scale;this.visible_area[0]=i,this.visible_area[1]=n,this.visible_area[2]=s-i,this.visible_area[3]=o-n}else this.visible_area[0]=this.visible_area[1]=this.visible_area[2]=this.visible_area[3]=0},s.prototype.onMouse=function(t){if(this.enabled){var e=this.element,i=e.getBoundingClientRect(),n=t.clientX-i.left,s=t.clientY-i.top;t.canvasx=n,t.canvasy=s,t.dragging=this.dragging;var o=!1;if(this.onmouse&&(o=this.onmouse(t)),"mousedown"==t.type)this.dragging=!0,e.removeEventListener("mousemove",this._binded_mouse_callback),document.body.addEventListener("mousemove",this._binded_mouse_callback),document.body.addEventListener("mouseup",this._binded_mouse_callback);else if("mousemove"==t.type){if(!o){var r=n-this.last_mouse[0],a=s-this.last_mouse[1];this.dragging&&this.mouseDrag(r,a)}}else"mouseup"==t.type?(this.dragging=!1,document.body.removeEventListener("mousemove",this._binded_mouse_callback),document.body.removeEventListener("mouseup",this._binded_mouse_callback),e.addEventListener("mousemove",this._binded_mouse_callback)):"mousewheel"!=t.type&&"wheel"!=t.type&&"DOMMouseScroll"!=t.type||(t.eventType="mousewheel","wheel"==t.type?t.wheel=-t.deltaY:t.wheel=null!=t.wheelDeltaY?t.wheelDeltaY:-60*t.detail,t.delta=t.wheelDelta?t.wheelDelta/40:t.deltaY?-t.deltaY/3:0,this.changeDeltaScale(1+.05*t.delta));return this.last_mouse[0]=n,this.last_mouse[1]=s,t.preventDefault(),t.stopPropagation(),!1}},s.prototype.toCanvasContext=function(t){t.scale(this.scale,this.scale),t.translate(this.offset[0],this.offset[1])},s.prototype.convertOffsetToCanvas=function(t){return[(t[0]+this.offset[0])*this.scale,(t[1]+this.offset[1])*this.scale]},s.prototype.convertCanvasToOffset=function(t,e){return(e=e||[0,0])[0]=t[0]/this.scale-this.offset[0],e[1]=t[1]/this.scale-this.offset[1],e},s.prototype.mouseDrag=function(t,e){this.offset[0]+=t/this.scale,this.offset[1]+=e/this.scale,this.onredraw&&this.onredraw(this)},s.prototype.changeScale=function(t,e){if(t<this.min_scale?t=this.min_scale:t>this.max_scale&&(t=this.max_scale),t!=this.scale&&this.element){var i=this.element.getBoundingClientRect();if(i){e=e||[.5*i.width,.5*i.height];var n=this.convertCanvasToOffset(e);this.scale=t,Math.abs(this.scale-1)<.01&&(this.scale=1);var s=this.convertCanvasToOffset(e),o=[s[0]-n[0],s[1]-n[1]];this.offset[0]+=o[0],this.offset[1]+=o[1],this.onredraw&&this.onredraw(this)}}},s.prototype.changeDeltaScale=function(t,e){this.changeScale(this.scale*t,e)},s.prototype.reset=function(){this.scale=1,this.offset[0]=0,this.offset[1]=0},p.LGraphCanvas=I.LGraphCanvas=A,A.link_type_colors={"-1":I.EVENT_LINK_COLOR,number:"#AAA",node:"#DCA"},A.gradients={},A.prototype.clear=function(){this.frame=0,this.last_draw_time=0,this.render_time=0,this.fps=0,this.dragging_rectangle=null,this.selected_nodes={},this.selected_group=null,this.visible_nodes=[],this.node_dragged=null,this.node_over=null,this.node_capturing_input=null,this.connecting_node=null,this.highlighted_links={},this.dirty_canvas=!0,this.dirty_bgcanvas=!0,this.dirty_area=null,this.node_in_panel=null,this.node_widget=null,this.last_mouse=[0,0],this.last_mouseclick=0,this.visible_area.set([0,0,0,0]),this.onClear&&this.onClear()},A.prototype.setGraph=function(t,e){this.graph!=t&&(e||this.clear(),t||!this.graph?(t.attachCanvas(this),this.setDirty(!0,!0)):this.graph.detachCanvas(this))},A.prototype.openSubgraph=function(t){if(!t)throw"graph cannot be null";if(this.graph==t)throw"graph cannot be the same";this.clear(),this.graph&&(this._graph_stack||(this._graph_stack=[]),this._graph_stack.push(this.graph)),t.attachCanvas(this),this.setDirty(!0,!0)},A.prototype.closeSubgraph=function(){if(this._graph_stack&&0!=this._graph_stack.length){var t=this.graph._subgraph_node,e=this._graph_stack.pop();this.selected_nodes={},this.highlighted_links={},e.attachCanvas(this),this.setDirty(!0,!0),t&&(this.centerOnNode(t),this.selectNodes([t]))}},A.prototype.getCurrentGraph=function(){return this.graph},A.prototype.setCanvas=function(t,e){if(t&&t.constructor===String&&!(t=document.getElementById(t)))throw"Error creating LiteGraph canvas: Canvas not found";if(t!==this.canvas&&(!t&&this.canvas&&(e||this.unbindEvents()),this.canvas=t,this.ds.element=t)){if(t.className+=" lgraphcanvas",t.data=this,t.tabindex="1",this.bgcanvas=null,this.bgcanvas||(this.bgcanvas=document.createElement("canvas"),this.bgcanvas.width=this.canvas.width,this.bgcanvas.height=this.canvas.height),null==t.getContext){if("canvas"!=t.localName)throw"Element supplied for LGraphCanvas must be a <canvas> element, you passed a "+t.localName;throw"This browser doesn't support Canvas"}null==(this.ctx=t.getContext("2d"))&&(t.webgl_enabled||console.warn("This canvas seems to be WebGL, enabling WebGL renderer"),this.enableWebGL()),this._mousemove_callback=this.processMouseMove.bind(this),this._mouseup_callback=this.processMouseUp.bind(this),e||this.bindEvents()}},A.prototype._doNothing=function(t){return t.preventDefault(),!1},A.prototype._doReturnTrue=function(t){return t.preventDefault(),!0},A.prototype.bindEvents=function(){if(this._events_binded)console.warn("LGraphCanvas: events already binded");else{var t=this.canvas,e=this.getCanvasWindow().document;this._mousedown_callback=this.processMouseDown.bind(this),this._mousewheel_callback=this.processMouseWheel.bind(this),t.addEventListener("mousedown",this._mousedown_callback,!0),t.addEventListener("mousemove",this._mousemove_callback),t.addEventListener("mousewheel",this._mousewheel_callback,!1),t.addEventListener("contextmenu",this._doNothing),t.addEventListener("DOMMouseScroll",this._mousewheel_callback,!1),t.addEventListener("touchstart",this.touchHandler,!0),t.addEventListener("touchmove",this.touchHandler,!0),t.addEventListener("touchend",this.touchHandler,!0),t.addEventListener("touchcancel",this.touchHandler,!0),this._key_callback=this.processKey.bind(this),t.addEventListener("keydown",this._key_callback,!0),e.addEventListener("keyup",this._key_callback,!0),this._ondrop_callback=this.processDrop.bind(this),t.addEventListener("dragover",this._doNothing,!1),t.addEventListener("dragend",this._doNothing,!1),t.addEventListener("drop",this._ondrop_callback,!1),t.addEventListener("dragenter",this._doReturnTrue,!1),this._events_binded=!0}},A.prototype.unbindEvents=function(){if(this._events_binded){var t=this.getCanvasWindow().document;this.canvas.removeEventListener("mousedown",this._mousedown_callback),this.canvas.removeEventListener("mousewheel",this._mousewheel_callback),this.canvas.removeEventListener("DOMMouseScroll",this._mousewheel_callback),this.canvas.removeEventListener("keydown",this._key_callback),t.removeEventListener("keyup",this._key_callback),this.canvas.removeEventListener("contextmenu",this._doNothing),this.canvas.removeEventListener("drop",this._ondrop_callback),this.canvas.removeEventListener("dragenter",this._doReturnTrue),this.canvas.removeEventListener("touchstart",this.touchHandler),this.canvas.removeEventListener("touchmove",this.touchHandler),this.canvas.removeEventListener("touchend",this.touchHandler),this.canvas.removeEventListener("touchcancel",this.touchHandler),this._mousedown_callback=null,this._mousewheel_callback=null,this._key_callback=null,this._ondrop_callback=null,this._events_binded=!1}else console.warn("LGraphCanvas: no events binded")},A.getFileExtension=function(t){var e=t.indexOf("?");-1!=e&&(t=t.substr(0,e));var i=t.lastIndexOf(".");return-1==i?"":t.substr(i+1).toLowerCase()},A.prototype.enableWebGL=function(){this.gl=this.ctx=enableWebGLCanvas(this.canvas),this.ctx.webgl=!0,this.bgcanvas=this.canvas,this.bgctx=this.gl,this.canvas.webgl_enabled=!0},A.prototype.setDirty=function(t,e){t&&(this.dirty_canvas=!0),e&&(this.dirty_bgcanvas=!0)},A.prototype.getCanvasWindow=function(){if(!this.canvas)return window;var t=this.canvas.ownerDocument;return t.defaultView||t.parentWindow},A.prototype.startRendering=function(){this.is_rendering||(this.is_rendering=!0,function t(){this.pause_rendering||this.draw();var e=this.getCanvasWindow();this.is_rendering&&e.requestAnimationFrame(t.bind(this))}.call(this))},A.prototype.stopRendering=function(){this.is_rendering=!1},A.prototype.processMouseDown=function(t){if(this.graph){this.adjustMouseEvent(t);var e=this.getCanvasWindow();e.document,A.active_canvas=this;this.canvas.removeEventListener("mousemove",this._mousemove_callback),e.document.addEventListener("mousemove",this._mousemove_callback,!0),e.document.addEventListener("mouseup",this._mouseup_callback,!0);var i=this.graph.getNodeOnPos(t.canvasX,t.canvasY,this.visible_nodes,5),n=!1,s=I.getTime()-this.last_mouseclick<300;if(this.canvas_mouse[0]=t.canvasX,this.canvas_mouse[1]=t.canvasY,this.canvas.focus(),I.closeAllContextMenus(e),!this.onMouse||1!=this.onMouse(t)){if(1==t.which){t.ctrlKey&&(this.dragging_rectangle=new Float32Array(4),this.dragging_rectangle[0]=t.canvasX,this.dragging_rectangle[1]=t.canvasY,this.dragging_rectangle[2]=1,this.dragging_rectangle[3]=1,n=!0);var o=!1;if(i&&this.allow_interaction&&!n&&!this.read_only){if(this.live_mode||i.flags.pinned||this.bringToFront(i),!this.connecting_node&&!i.flags.collapsed&&!this.live_mode)if(!n&&!1!==i.resizable&&v(t.canvasX,t.canvasY,i.pos[0]+i.size[0]-5,i.pos[1]+i.size[1]-5,10,10))this.resizing_node=i,this.canvas.style.cursor="se-resize",n=!0;else{if(i.outputs)for(var r=0,a=i.outputs.length;r<a;++r){var l=i.outputs[r],h=i.getConnectionPos(!1,r);if(v(t.canvasX,t.canvasY,h[0]-15,h[1]-10,30,20)){this.connecting_node=i,this.connecting_output=l,this.connecting_pos=i.getConnectionPos(!1,r),this.connecting_slot=r,t.shiftKey&&i.disconnectOutput(r),s?i.onOutputDblClick&&i.onOutputDblClick(r,t):i.onOutputClick&&i.onOutputClick(r,t),n=!0;break}}if(i.inputs)for(r=0,a=i.inputs.length;r<a;++r){var u=i.inputs[r];h=i.getConnectionPos(!0,r);if(v(t.canvasX,t.canvasY,h[0]-15,h[1]-10,30,20)&&(s?i.onInputDblClick&&i.onInputDblClick(r,t):i.onInputClick&&i.onInputClick(r,t),null!==u.link)){var p=this.graph.links[u.link];i.disconnectInput(r),(this.allow_reconnect_links||t.shiftKey)&&(this.connecting_node=this.graph._nodes_by_id[p.origin_id],this.connecting_slot=p.origin_slot,this.connecting_output=this.connecting_node.outputs[this.connecting_slot],this.connecting_pos=this.connecting_node.getConnectionPos(!1,this.connecting_slot)),n=this.dirty_bgcanvas=!0}}}if(!n){var c=!1,d=this.processNodeWidgets(i,this.canvas_mouse,t);d&&(c=!0,this.node_widget=[i,d]),s&&this.selected_nodes[i.id]&&(i.onDblClick&&i.onDblClick(t,[t.canvasX-i.pos[0],t.canvasY-i.pos[1]],this),this.processNodeDblClicked(i),c=!0),i.onMouseDown&&i.onMouseDown(t,[t.canvasX-i.pos[0],t.canvasY-i.pos[1]],this)?c=!0:this.live_mode&&(c=o=!0),c||(this.allow_dragnodes&&(this.node_dragged=i),this.selected_nodes[i.id]||this.processNodeSelected(i,t)),this.dirty_canvas=!0}}else{if(!this.read_only)for(r=0;r<this.visible_links.length;++r){var g=this.visible_links[r],_=g._pos;if(!(!_||t.canvasX<_[0]-4||t.canvasX>_[0]+4||t.canvasY<_[1]-4||t.canvasY>_[1]+4)){this.showLinkMenu(g,t);break}}if(this.selected_group=this.graph.getGroupOnPos(t.canvasX,t.canvasY),this.selected_group_resizing=!1,this.selected_group&&!this.read_only)t.ctrlKey&&(this.dragging_rectangle=null),S([t.canvasX,t.canvasY],[this.selected_group.pos[0]+this.selected_group.size[0],this.selected_group.pos[1]+this.selected_group.size[1]])*this.ds.scale<10?this.selected_group_resizing=!0:this.selected_group.recomputeInsideNodes();s&&!this.read_only&&this.showSearchBox(t),o=!0}!n&&o&&this.allow_dragcanvas&&(this.dragging_canvas=!0)}else 2==t.which||3==t.which&&(this.read_only||this.processContextMenu(i,t));return this.last_mouse[0]=t.localX,this.last_mouse[1]=t.localY,this.last_mouseclick=I.getTime(),this.last_mouse_dragging=!0,this.graph.change(),e.document.activeElement&&("input"==e.document.activeElement.nodeName.toLowerCase()||"textarea"==e.document.activeElement.nodeName.toLowerCase())||t.preventDefault(),t.stopPropagation(),this.onMouseDown&&this.onMouseDown(t),!1}}},A.prototype.processMouseMove=function(t){if(this.autoresize&&this.resize(),this.graph){(A.active_canvas=this).adjustMouseEvent(t);var e=[t.localX,t.localY],i=[e[0]-this.last_mouse[0],e[1]-this.last_mouse[1]];if(this.last_mouse=e,this.canvas_mouse[0]=t.canvasX,this.canvas_mouse[1]=t.canvasY,t.dragging=this.last_mouse_dragging,this.node_widget&&(this.processNodeWidgets(this.node_widget[0],this.canvas_mouse,t,this.node_widget[1]),this.dirty_canvas=!0),this.dragging_rectangle)this.dragging_rectangle[2]=t.canvasX-this.dragging_rectangle[0],this.dragging_rectangle[3]=t.canvasY-this.dragging_rectangle[1],this.dirty_canvas=!0;else if(this.selected_group&&!this.read_only){if(this.selected_group_resizing)this.selected_group.size=[t.canvasX-this.selected_group.pos[0],t.canvasY-this.selected_group.pos[1]];else{var n=i[0]/this.ds.scale,s=i[1]/this.ds.scale;this.selected_group.move(n,s,t.ctrlKey),this.selected_group._nodes.length&&(this.dirty_canvas=!0)}this.dirty_bgcanvas=!0}else if(this.dragging_canvas)this.ds.offset[0]+=i[0]/this.ds.scale,this.ds.offset[1]+=i[1]/this.ds.scale,this.dirty_canvas=!0,this.dirty_bgcanvas=!0;else if(this.allow_interaction&&!this.read_only){this.connecting_node&&(this.dirty_canvas=!0);for(var o=this.graph.getNodeOnPos(t.canvasX,t.canvasY,this.visible_nodes),r=0,a=this.graph._nodes.length;r<a;++r)this.graph._nodes[r].mouseOver&&o!=this.graph._nodes[r]&&(this.graph._nodes[r].mouseOver=!1,this.node_over&&this.node_over.onMouseLeave&&this.node_over.onMouseLeave(t),this.node_over=null,this.dirty_canvas=!0);if(o){if(o.mouseOver||(o.mouseOver=!0,this.node_over=o,this.dirty_canvas=!0,o.onMouseEnter&&o.onMouseEnter(t)),o.onMouseMove&&o.onMouseMove(t,[t.canvasX-o.pos[0],t.canvasY-o.pos[1]],this),this.connecting_node){var l=this._highlight_input||[0,0];if(this.isOverNodeBox(o,t.canvasX,t.canvasY));else{var h=this.isOverNodeInput(o,t.canvasX,t.canvasY,l);if(-1!=h&&o.inputs[h]){var u=o.inputs[h].type;I.isValidConnection(this.connecting_output.type,u)&&(this._highlight_input=l)}else this._highlight_input=null}}this.canvas&&(v(t.canvasX,t.canvasY,o.pos[0]+o.size[0]-5,o.pos[1]+o.size[1]-5,5,5)?this.canvas.style.cursor="se-resize":this.canvas.style.cursor="crosshair")}else this.canvas&&(this.canvas.style.cursor="");if(this.node_capturing_input&&this.node_capturing_input!=o&&this.node_capturing_input.onMouseMove&&this.node_capturing_input.onMouseMove(t),this.node_dragged&&!this.live_mode){for(var r in this.selected_nodes){var p=this.selected_nodes[r];p.pos[0]+=i[0]/this.ds.scale,p.pos[1]+=i[1]/this.ds.scale}this.dirty_canvas=!0,this.dirty_bgcanvas=!0}if(this.resizing_node&&!this.live_mode){this.resizing_node.size[0]=t.canvasX-this.resizing_node.pos[0],this.resizing_node.size[1]=t.canvasY-this.resizing_node.pos[1];var c=Math.max(this.resizing_node.inputs?this.resizing_node.inputs.length:0,this.resizing_node.outputs?this.resizing_node.outputs.length:0)*I.NODE_SLOT_HEIGHT+(this.resizing_node.widgets?this.resizing_node.widgets.length:0)*(I.NODE_WIDGET_HEIGHT+4)+4;this.resizing_node.size[1]<c&&(this.resizing_node.size[1]=c),this.resizing_node.size[0]<I.NODE_MIN_WIDTH&&(this.resizing_node.size[0]=I.NODE_MIN_WIDTH),this.canvas.style.cursor="se-resize",this.dirty_canvas=!0,this.dirty_bgcanvas=!0}}return t.preventDefault(),!1}},A.prototype.processMouseUp=function(t){if(this.graph){var e=this.getCanvasWindow().document;A.active_canvas=this,e.removeEventListener("mousemove",this._mousemove_callback,!0),this.canvas.addEventListener("mousemove",this._mousemove_callback,!0),e.removeEventListener("mouseup",this._mouseup_callback,!0),this.adjustMouseEvent(t);var i=I.getTime();if(t.click_time=i-this.last_mouseclick,this.last_mouse_dragging=!1,1==t.which){if(this.node_widget=null,this.selected_group){var n=this.selected_group.pos[0]-Math.round(this.selected_group.pos[0]),s=this.selected_group.pos[1]-Math.round(this.selected_group.pos[1]);this.selected_group.move(n,s,t.ctrlKey),this.selected_group.pos[0]=Math.round(this.selected_group.pos[0]),this.selected_group.pos[1]=Math.round(this.selected_group.pos[1]),this.selected_group._nodes.length&&(this.dirty_canvas=!0),this.selected_group=null}if(this.selected_group_resizing=!1,this.dragging_rectangle){if(this.graph){var o=this.graph._nodes,r=new Float32Array(4);this.deselectAllNodes();var a=Math.abs(this.dragging_rectangle[2]),l=Math.abs(this.dragging_rectangle[3]),h=this.dragging_rectangle[2]<0?this.dragging_rectangle[0]-a:this.dragging_rectangle[0],u=this.dragging_rectangle[3]<0?this.dragging_rectangle[1]-l:this.dragging_rectangle[1];this.dragging_rectangle[0]=h,this.dragging_rectangle[1]=u,this.dragging_rectangle[2]=a,this.dragging_rectangle[3]=l;for(var p=[],c=0;c<o.length;++c){(_=o[c]).getBounding(r),w(this.dragging_rectangle,r)&&p.push(_)}p.length&&this.selectNodes(p)}this.dragging_rectangle=null}else if(this.connecting_node){if(this.dirty_canvas=!0,this.dirty_bgcanvas=!0,_=this.graph.getNodeOnPos(t.canvasX,t.canvasY,this.visible_nodes))if(this.connecting_output.type==I.EVENT&&this.isOverNodeBox(_,t.canvasX,t.canvasY))this.connecting_node.connect(this.connecting_slot,_,I.EVENT);else{var d=this.isOverNodeInput(_,t.canvasX,t.canvasY);if(-1!=d)this.connecting_node.connect(this.connecting_slot,_,d);else{var g=_.getInputInfo(0);this.connecting_output.type==I.EVENT?this.connecting_node.connect(this.connecting_slot,_,I.EVENT):g&&!g.link&&I.isValidConnection(g.type&&this.connecting_output.type)&&this.connecting_node.connect(this.connecting_slot,_,0)}}this.connecting_output=null,this.connecting_pos=null,this.connecting_node=null,this.connecting_slot=-1}else if(this.resizing_node)this.dirty_canvas=!0,this.dirty_bgcanvas=!0,this.resizing_node=null;else if(this.node_dragged){(_=this.node_dragged)&&t.click_time<300&&v(t.canvasX,t.canvasY,_.pos[0],_.pos[1]-I.NODE_TITLE_HEIGHT,I.NODE_TITLE_HEIGHT,I.NODE_TITLE_HEIGHT)&&_.collapse(),this.dirty_canvas=!0,this.dirty_bgcanvas=!0,this.node_dragged.pos[0]=Math.round(this.node_dragged.pos[0]),this.node_dragged.pos[1]=Math.round(this.node_dragged.pos[1]),this.graph.config.align_to_grid&&this.node_dragged.alignToGrid(),this.node_dragged=null}else{var _;!(_=this.graph.getNodeOnPos(t.canvasX,t.canvasY,this.visible_nodes))&&t.click_time<300&&this.deselectAllNodes(),this.dirty_canvas=!0,this.dragging_canvas=!1,this.node_over&&this.node_over.onMouseUp&&this.node_over.onMouseUp(t,[t.canvasX-this.node_over.pos[0],t.canvasY-this.node_over.pos[1]],this),this.node_capturing_input&&this.node_capturing_input.onMouseUp&&this.node_capturing_input.onMouseUp(t,[t.canvasX-this.node_capturing_input.pos[0],t.canvasY-this.node_capturing_input.pos[1]])}}else 2==t.which?(this.dirty_canvas=!0,this.dragging_canvas=!1):3==t.which&&(this.dirty_canvas=!0,this.dragging_canvas=!1);return this.graph.change(),t.stopPropagation(),t.preventDefault(),!1}},A.prototype.processMouseWheel=function(t){if(this.graph&&this.allow_dragcanvas){var e=null!=t.wheelDeltaY?t.wheelDeltaY:-60*t.detail;this.adjustMouseEvent(t);var i=this.ds.scale;return 0<e?i*=1.1:e<0&&(i*=1/1.1),this.ds.changeScale(i,[t.localX,t.localY]),this.graph.change(),t.preventDefault(),!1}},A.prototype.isOverNodeBox=function(t,e,i){var n=I.NODE_TITLE_HEIGHT;return!!v(e,i,t.pos[0]+2,t.pos[1]+2-n,n-4,n-4)},A.prototype.isOverNodeInput=function(t,e,i,n){if(t.inputs)for(var s=0,o=t.inputs.length;s<o;++s){t.inputs[s];var r=t.getConnectionPos(!0,s);if(t.horizontal?v(e,i,r[0]-5,r[1]-10,10,20):v(e,i,r[0]-10,r[1]-5,40,10))return n&&(n[0]=r[0],n[1]=r[1]),s}return-1},A.prototype.processKey=function(t){if(this.graph){var e=!1;if("input"!=t.target.localName){if("keydown"==t.type){if(32==t.keyCode&&(e=this.dragging_canvas=!0),65==t.keyCode&&t.ctrlKey&&(this.selectNodes(),e=!0),"KeyC"!=t.code||!t.metaKey&&!t.ctrlKey||t.shiftKey||this.selected_nodes&&(this.copyToClipboard(),e=!0),"KeyV"!=t.code||!t.metaKey&&!t.ctrlKey||t.shiftKey||this.pasteFromClipboard(),46!=t.keyCode&&8!=t.keyCode||"input"!=t.target.localName&&"textarea"!=t.target.localName&&(this.deleteSelectedNodes(),e=!0),this.selected_nodes)for(var i in this.selected_nodes)this.selected_nodes[i].onKeyDown&&this.selected_nodes[i].onKeyDown(t)}else if("keyup"==t.type&&(32==t.keyCode&&(this.dragging_canvas=!1),this.selected_nodes))for(var i in this.selected_nodes)this.selected_nodes[i].onKeyUp&&this.selected_nodes[i].onKeyUp(t);return this.graph.change(),e?(t.preventDefault(),t.stopImmediatePropagation(),!1):void 0}}},A.prototype.copyToClipboard=function(){var t={nodes:[],links:[]},e=0,i=[];for(var n in this.selected_nodes){(s=this.selected_nodes[n])._relative_id=e,i.push(s),e+=1}for(n=0;n<i.length;++n){var s=i[n];if(t.nodes.push(s.clone().serialize()),s.inputs&&s.inputs.length)for(var o=0;o<s.inputs.length;++o){var r=s.inputs[o];if(r&&null!=r.link){var a=this.graph.links[r.link];if(a){var l=this.graph.getNodeById(a.origin_id);l&&this.selected_nodes[l.id]&&t.links.push([l._relative_id,o,s._relative_id,a.target_slot])}}}}localStorage.setItem("litegrapheditor_clipboard",JSON.stringify(t))},A.prototype.pasteFromClipboard=function(){var t=localStorage.getItem("litegrapheditor_clipboard");if(t){for(var e=JSON.parse(t),i=[],n=0;n<e.nodes.length;++n){var s=e.nodes[n],o=I.createNode(s.type);o&&(o.configure(s),o.pos[0]+=5,o.pos[1]+=5,this.graph.add(o),i.push(o))}for(n=0;n<e.links.length;++n){var r=e.links[n],a=i[r[0]],l=i[r[2]];a.connect(r[1],l,r[3])}this.selectNodes(i)}},A.prototype.processDrop=function(t){t.preventDefault(),this.adjustMouseEvent(t);var e=[t.canvasX,t.canvasY],i=this.graph.getNodeOnPos(e[0],e[1]);if(!i){var n=null;return this.onDropItem&&(n=this.onDropItem(event)),void(n||this.checkDropItem(t))}if(i.onDropFile||i.onDropData){var s=t.dataTransfer.files;if(s&&s.length)for(var o=0;o<s.length;o++){var r=t.dataTransfer.files[0],a=r.name;A.getFileExtension(a);if(i.onDropFile&&i.onDropFile(r),i.onDropData){var l=new FileReader;l.onload=function(t){var e=t.target.result;i.onDropData(e,a,r)};var h=r.type.split("/")[0];"text"==h||""==h?l.readAsText(r):"image"==h?l.readAsDataURL(r):l.readAsArrayBuffer(r)}}}return!(!i.onDropItem||!i.onDropItem(event))||!!this.onDropItem&&this.onDropItem(event)},A.prototype.checkDropItem=function(t){if(t.dataTransfer.files.length){var e=t.dataTransfer.files[0],i=A.getFileExtension(e.name).toLowerCase(),n=I.node_types_by_file_extension[i];if(n){var s=I.createNode(n.type);s.pos=[t.canvasX,t.canvasY],this.graph.add(s),s.onDropFile&&s.onDropFile(e)}}},A.prototype.processNodeDblClicked=function(t){this.onShowNodePanel&&this.onShowNodePanel(t),this.onNodeDblClicked&&this.onNodeDblClicked(t),this.setDirty(!0)},A.prototype.processNodeSelected=function(t,e){this.selectNode(t,e&&e.shiftKey),this.onNodeSelected&&this.onNodeSelected(t)},A.prototype.processNodeDeselected=function(t){this.deselectNode(t),this.onNodeDeselected&&this.onNodeDeselected(t)},A.prototype.selectNode=function(t,e){null==t?this.deselectAllNodes():this.selectNodes([t],e)},A.prototype.selectNodes=function(t,e){e||this.deselectAllNodes(),t=t||this.graph._nodes;for(var i=0;i<t.length;++i){var n=t[i];if(!n.is_selected){if(!n.is_selected&&n.onSelected&&n.onSelected(),n.is_selected=!0,(this.selected_nodes[n.id]=n).inputs)for(var s=0;s<n.inputs.length;++s)this.highlighted_links[n.inputs[s].link]=!0;if(n.outputs)for(s=0;s<n.outputs.length;++s){var o=n.outputs[s];if(o.links)for(var r=0;r<o.links.length;++r)this.highlighted_links[o.links[r]]=!0}}}this.setDirty(!0)},A.prototype.deselectNode=function(t){if(t.is_selected){if(t.onDeselected&&t.onDeselected(),t.is_selected=!1,t.inputs)for(var e=0;e<t.inputs.length;++e)delete this.highlighted_links[t.inputs[e].link];if(t.outputs)for(e=0;e<t.outputs.length;++e){var i=t.outputs[e];if(i.links)for(var n=0;n<i.links.length;++n)delete this.highlighted_links[i.links[n]]}}},A.prototype.deselectAllNodes=function(){if(this.graph){for(var t=this.graph._nodes,e=0,i=t.length;e<i;++e){var n=t[e];n.is_selected&&(n.onDeselected&&n.onDeselected(),n.is_selected=!1)}this.selected_nodes={},this.current_node=null,this.highlighted_links={},this.setDirty(!0)}},A.prototype.deleteSelectedNodes=function(){for(var t in this.selected_nodes){var e=this.selected_nodes[t];this.graph.remove(e)}this.selected_nodes={},this.current_node=null,this.highlighted_links={},this.setDirty(!0)},A.prototype.centerOnNode=function(t){this.ds.offset[0]=-t.pos[0]-.5*t.size[0]+.5*this.canvas.width/this.ds.scale,this.ds.offset[1]=-t.pos[1]-.5*t.size[1]+.5*this.canvas.height/this.ds.scale,this.setDirty(!0,!0)},A.prototype.adjustMouseEvent=function(t){if(this.canvas){var e=this.canvas.getBoundingClientRect();t.localX=t.clientX-e.left,t.localY=t.clientY-e.top}else t.localX=t.clientX,t.localY=t.clientY;t.deltaX=t.localX-this.last_mouse_position[0],t.deltaY=t.localY-this.last_mouse_position[1],this.last_mouse_position[0]=t.localX,this.last_mouse_position[1]=t.localY,t.canvasX=t.localX/this.ds.scale-this.ds.offset[0],t.canvasY=t.localY/this.ds.scale-this.ds.offset[1]},A.prototype.setZoom=function(t,e){this.ds.changeScale(t,e),this.dirty_canvas=!0,this.dirty_bgcanvas=!0},A.prototype.convertOffsetToCanvas=function(t,e){return this.ds.convertOffsetToCanvas(t,e)},A.prototype.convertCanvasToOffset=function(t,e){return this.ds.convertCanvasToOffset(t,e)},A.prototype.convertEventToCanvasOffset=function(t){var e=this.canvas.getBoundingClientRect();return this.convertCanvasToOffset([t.clientX-e.left,t.clientY-e.top])},A.prototype.bringToFront=function(t){var e=this.graph._nodes.indexOf(t);-1!=e&&(this.graph._nodes.splice(e,1),this.graph._nodes.push(t))},A.prototype.sendToBack=function(t){var e=this.graph._nodes.indexOf(t);-1!=e&&(this.graph._nodes.splice(e,1),this.graph._nodes.unshift(t))};var r=new Float32Array(4);A.prototype.computeVisibleNodes=function(t,e){for(var i=e||[],n=i.length=0,s=(t=t||this.graph._nodes).length;n<s;++n){var o=t[n];(!this.live_mode||o.onDrawBackground||o.onDrawForeground)&&w(this.visible_area,o.getBounding(r))&&i.push(o)}return i},A.prototype.draw=function(t,e){if(this.canvas){var i=I.getTime();this.render_time=.001*(i-this.last_draw_time),this.last_draw_time=i,this.graph&&this.ds.computeVisibleArea(),(this.dirty_bgcanvas||e||this.always_render_background||this.graph&&this.graph._last_trigger_time&&i-this.graph._last_trigger_time<1e3)&&this.drawBackCanvas(),(this.dirty_canvas||t)&&this.drawFrontCanvas(),this.fps=this.render_time?1/this.render_time:0,this.frame+=1}},A.prototype.drawFrontCanvas=function(){this.dirty_canvas=!1,this.ctx||(this.ctx=this.bgcanvas.getContext("2d"));var t=this.ctx;if(t){t.start2D&&t.start2D();var e=this.canvas;if(t.restore(),t.setTransform(1,0,0,1,0,0),this.dirty_area&&(t.save(),t.beginPath(),t.rect(this.dirty_area[0],this.dirty_area[1],this.dirty_area[2],this.dirty_area[3]),t.clip()),this.clear_background&&t.clearRect(0,0,e.width,e.height),this.bgcanvas==this.canvas?this.drawBackCanvas():t.drawImage(this.bgcanvas,0,0),this.onRender&&this.onRender(e,t),this.graph){t.save(),this.ds.toCanvasContext(t);for(var i=this.computeVisibleNodes(null,this.visible_nodes),n=0;n<i.length;++n){var s=i[n];t.save(),t.translate(s.pos[0],s.pos[1]),this.drawNode(s,t),1,t.restore()}if(this.render_execution_order&&this.drawExecutionOrder(t),this.graph.config.links_ontop&&(this.live_mode||this.drawConnections(t)),null!=this.connecting_pos){t.lineWidth=this.connections_width;var o=null;switch(this.connecting_output.type){case I.EVENT:o=I.EVENT_LINK_COLOR;break;default:o=I.CONNECTING_LINK_COLOR}this.renderLink(t,this.connecting_pos,[this.canvas_mouse[0],this.canvas_mouse[1]],null,!1,null,o,this.connecting_output.dir||(this.connecting_node.horizontal?I.DOWN:I.RIGHT),I.CENTER),t.beginPath(),this.connecting_output.type===I.EVENT||this.connecting_output.shape===I.BOX_SHAPE?t.rect(this.connecting_pos[0]-6+.5,this.connecting_pos[1]-5+.5,14,10):t.arc(this.connecting_pos[0],this.connecting_pos[1],4,0,2*Math.PI),t.fill(),t.fillStyle="#ffcc00",this._highlight_input&&(t.beginPath(),t.arc(this._highlight_input[0],this._highlight_input[1],6,0,2*Math.PI),t.fill())}this.dragging_rectangle&&(t.strokeStyle="#FFF",t.strokeRect(this.dragging_rectangle[0],this.dragging_rectangle[1],this.dragging_rectangle[2],this.dragging_rectangle[3])),this.onDrawForeground&&this.onDrawForeground(t,this.visible_rect),t.restore()}this.onDrawOverlay&&this.onDrawOverlay(t),this.dirty_area&&t.restore(),t.finish2D&&t.finish2D()}},A.prototype.drawBackCanvas=function(){var t=this.bgcanvas;t.width==this.canvas.width&&t.height==this.canvas.height||(t.width=this.canvas.width,t.height=this.canvas.height),this.bgctx||(this.bgctx=this.bgcanvas.getContext("2d"));var e=this.bgctx;if(e.start&&e.start(),this.clear_background&&e.clearRect(0,0,t.width,t.height),this._graph_stack&&this._graph_stack.length){e.save();this._graph_stack[this._graph_stack.length-1];var i=this.graph._subgraph_node;e.strokeStyle=i.bgcolor,e.lineWidth=10,e.strokeRect(1,1,t.width-2,t.height-2),e.lineWidth=1,e.font="40px Arial",e.textAlign="center",e.fillStyle=i.bgcolor||"#AAA";for(var n="",s=1;s<this._graph_stack.length;++s)n+=this._graph_stack[s]._subgraph_node.getTitle()+" >> ";e.fillText(n+i.getTitle(),.5*t.width,40),e.restore()}var o=!1;if(this.onRenderBackground&&(o=this.onRenderBackground(t,e)),e.restore(),e.setTransform(1,0,0,1,0,0),this.visible_links.length=0,this.graph){if(e.save(),this.ds.toCanvasContext(e),this.background_image&&.5<this.ds.scale&&!o){if(this.zoom_modify_alpha?e.globalAlpha=(1-.5/this.ds.scale)*this.editor_alpha:e.globalAlpha=this.editor_alpha,e.imageSmoothingEnabled=e.mozImageSmoothingEnabled=e.imageSmoothingEnabled=!1,!this._bg_img||this._bg_img.name!=this.background_image){this._bg_img=new Image,this._bg_img.name=this.background_image,this._bg_img.src=this.background_image;var r=this;this._bg_img.onload=function(){r.draw(!0,!0)}}var a=null;null==this._pattern&&0<this._bg_img.width?(a=e.createPattern(this._bg_img,"repeat"),this._pattern_img=this._bg_img,this._pattern=a):a=this._pattern,a&&(e.fillStyle=a,e.fillRect(this.visible_area[0],this.visible_area[1],this.visible_area[2],this.visible_area[3]),e.fillStyle="transparent"),e.globalAlpha=1,e.imageSmoothingEnabled=e.mozImageSmoothingEnabled=e.imageSmoothingEnabled=!0}this.graph._groups.length&&!this.live_mode&&this.drawGroups(t,e),this.onDrawBackground&&this.onDrawBackground(e,this.visible_area),this.onBackgroundRender&&(console.error("WARNING! onBackgroundRender deprecated, now is named onDrawBackground "),this.onBackgroundRender=null),this.render_canvas_border&&(e.strokeStyle="#235",e.strokeRect(0,0,t.width,t.height)),this.render_connections_shadows?(e.shadowColor="#000",e.shadowOffsetX=0,e.shadowOffsetY=0,e.shadowBlur=6):e.shadowColor="rgba(0,0,0,0)",this.live_mode||this.drawConnections(e),e.shadowColor="rgba(0,0,0,0)",e.restore()}e.finish&&e.finish(),this.dirty_bgcanvas=!1,this.dirty_canvas=!0};var E=new Float32Array(2);A.prototype.drawNode=function(t,e){var i=(this.current_node=t).color||t.constructor.color||I.NODE_DEFAULT_COLOR,n=t.bgcolor||t.constructor.bgcolor||I.NODE_DEFAULT_BGCOLOR;if(t.mouseOver&&!0,this.live_mode)t.flags.collapsed||(e.shadowColor="transparent",t.onDrawForeground&&t.onDrawForeground(e,this,this.canvas));else{var s=this.editor_alpha;if(e.globalAlpha=s,this.render_shadows?(e.shadowColor=I.DEFAULT_SHADOW_COLOR,e.shadowOffsetX=2*this.ds.scale,e.shadowOffsetY=2*this.ds.scale,e.shadowBlur=3*this.ds.scale):e.shadowColor="transparent",!t.flags.collapsed||!t.onDrawCollapsed||1!=t.onDrawCollapsed(e,this)){var o=t._shape||I.BOX_SHAPE,r=E;E.set(t.size);var a=t.horizontal;if(t.flags.collapsed){e.font=this.inner_text_font;var l=t.getTitle?t.getTitle():t.title;null!=l&&(t._collapsed_width=Math.min(t.size[0],e.measureText(l).width+2*I.NODE_TITLE_HEIGHT),r[0]=t._collapsed_width,r[1]=0)}t.clip_area&&(e.save(),e.beginPath(),o==I.BOX_SHAPE?e.rect(0,0,r[0],r[1]):o==I.ROUND_SHAPE?e.roundRect(0,0,r[0],r[1],10):o==I.CIRCLE_SHAPE&&e.arc(.5*r[0],.5*r[1],.5*r[0],0,2*Math.PI),e.clip()),t.has_errors&&(n="red"),this.drawNodeShape(t,e,r,i,n,t.is_selected,t.mouseOver),e.shadowColor="transparent",t.onDrawForeground&&t.onDrawForeground(e,this,this.canvas),e.textAlign=a?"center":"left",e.font=this.inner_text_font;var h=.6<this.ds.scale,u=this.connecting_output;e.lineWidth=1;var p=0,c=new Float32Array(2);if(t.flags.collapsed){if(this.render_collapsed_slots){var d=null,g=null;if(t.inputs)for(f=0;f<t.inputs.length;f++){if(null!=(y=t.inputs[f]).link){d=y;break}}if(t.outputs)for(f=0;f<t.outputs.length;f++){(y=t.outputs[f]).links&&y.links.length&&(g=y)}if(d){var _=0,v=-.5*I.NODE_TITLE_HEIGHT;a&&(_=.5*t._collapsed_width,v=-I.NODE_TITLE_HEIGHT),e.fillStyle="#686",e.beginPath(),y.type===I.EVENT||y.shape===I.BOX_SHAPE?e.rect(_-7+.5,v-4,14,8):y.shape===I.ARROW_SHAPE?(e.moveTo(_+8,v),e.lineTo(_+-4,v-4),e.lineTo(_+-4,v+4),e.closePath()):e.arc(_,v,4,0,2*Math.PI),e.fill()}if(g){_=t._collapsed_width,v=-.5*I.NODE_TITLE_HEIGHT;a&&(_=.5*t._collapsed_width,v=0),e.fillStyle="#686",e.strokeStyle="black",e.beginPath(),y.type===I.EVENT||y.shape===I.BOX_SHAPE?e.rect(_-7+.5,v-4,14,8):y.shape===I.ARROW_SHAPE?(e.moveTo(_+6,v),e.lineTo(_-6,v-4),e.lineTo(_-6,v+4),e.closePath()):e.arc(_,v,4,0,2*Math.PI),e.fill()}}}else{if(t.inputs)for(var f=0;f<t.inputs.length;f++){var y=t.inputs[f];if(e.globalAlpha=s,this.connecting_node&&I.isValidConnection(y.type&&u.type)&&(e.globalAlpha=.4*s),e.fillStyle=null!=y.link?y.color_on||this.default_connection_color.input_on:y.color_off||this.default_connection_color.input_off,(m=t.getConnectionPos(!0,f,c))[0]-=t.pos[0],m[1]-=t.pos[1],p<m[1]+.5*I.NODE_SLOT_HEIGHT&&(p=m[1]+.5*I.NODE_SLOT_HEIGHT),e.beginPath(),y.type===I.EVENT||y.shape===I.BOX_SHAPE?a?e.rect(m[0]-5+.5,m[1]-8+.5,10,14):e.rect(m[0]-6+.5,m[1]-5+.5,14,10):y.shape===I.ARROW_SHAPE?(e.moveTo(m[0]+8,m[1]+.5),e.lineTo(m[0]-4,m[1]+6+.5),e.lineTo(m[0]-4,m[1]-6+.5),e.closePath()):e.arc(m[0],m[1],4,0,2*Math.PI),e.fill(),h)(b=null!=y.label?y.label:y.name)&&(e.fillStyle=I.NODE_TEXT_COLOR,a||y.dir==I.UP?e.fillText(b,m[0],m[1]-10):e.fillText(b,m[0]+10,m[1]+5))}if(this.connecting_node&&(e.globalAlpha=.4*s),e.textAlign=a?"center":"right",e.strokeStyle="black",t.outputs)for(var f=0;f<t.outputs.length;f++){var m,b,y=t.outputs[f];if((m=t.getConnectionPos(!1,f,c))[0]-=t.pos[0],m[1]-=t.pos[1],p<m[1]+.5*I.NODE_SLOT_HEIGHT&&(p=m[1]+.5*I.NODE_SLOT_HEIGHT),e.fillStyle=y.links&&y.links.length?y.color_on||this.default_connection_color.output_on:y.color_off||this.default_connection_color.output_off,e.beginPath(),y.type===I.EVENT||y.shape===I.BOX_SHAPE?a?e.rect(m[0]-5+.5,m[1]-8+.5,10,14):e.rect(m[0]-6+.5,m[1]-5+.5,14,10):y.shape===I.ARROW_SHAPE?(e.moveTo(m[0]+8,m[1]+.5),e.lineTo(m[0]-4,m[1]+6+.5),e.lineTo(m[0]-4,m[1]-6+.5),e.closePath()):e.arc(m[0],m[1],4,0,2*Math.PI),e.fill(),e.stroke(),h)(b=null!=y.label?y.label:y.name)&&(e.fillStyle=I.NODE_TEXT_COLOR,a||y.dir==I.DOWN?e.fillText(b,m[0],m[1]-8):e.fillText(b,m[0]-10,m[1]+5))}e.textAlign="left",e.globalAlpha=1,t.widgets&&((a||t.widgets_up)&&(p=2),this.drawNodeWidgets(t,p,e,this.node_widget&&this.node_widget[0]==t?this.node_widget[1]:null))}t.clip_area&&e.restore(),e.globalAlpha=1}}};var y=new Float32Array(4);A.prototype.drawNodeShape=function(t,e,i,n,s,o,r){e.strokeStyle=n,e.fillStyle=s;var a=I.NODE_TITLE_HEIGHT,l=this.ds.scale<.5,h=t._shape||t.constructor.shape||I.ROUND_SHAPE,u=t.constructor.title_mode,p=!0;u==I.TRANSPARENT_TITLE?p=!1:u==I.AUTOHIDE_TITLE&&r&&(p=!0);var c=y;c[0]=0,c[1]=p?-a:0,c[2]=i[0]+1,c[3]=p?i[1]+a:i[1];var d=e.globalAlpha;if(e.beginPath(),h==I.BOX_SHAPE||l?e.fillRect(c[0],c[1],c[2],c[3]):h==I.ROUND_SHAPE||h==I.CARD_SHAPE?e.roundRect(c[0],c[1],c[2],c[3],this.round_radius,h==I.CARD_SHAPE?0:this.round_radius):h==I.CIRCLE_SHAPE&&e.arc(.5*i[0],.5*i[1],.5*i[0],0,2*Math.PI),e.fill(),e.shadowColor="transparent",e.fillStyle="rgba(0,0,0,0.2)",e.fillRect(0,-1,c[2],2),e.shadowColor="transparent",t.onDrawBackground&&t.onDrawBackground(e,this,this.canvas),p||u==I.TRANSPARENT_TITLE){if(t.onDrawTitleBar)t.onDrawTitleBar(e,a,i,this.ds.scale,n);else if(u!=I.TRANSPARENT_TITLE&&(t.constructor.title_color||this.render_title_colored)){var g=t.constructor.title_color||n;if(t.flags.collapsed&&(e.shadowColor=I.DEFAULT_SHADOW_COLOR),this.use_gradients){var _=A.gradients[g];_||((_=A.gradients[g]=e.createLinearGradient(0,0,400,0)).addColorStop(0,g),_.addColorStop(1,"#000")),e.fillStyle=_}else e.fillStyle=g;e.beginPath(),h==I.BOX_SHAPE||l?e.rect(0,-a,i[0]+1,a):h!=I.ROUND_SHAPE&&h!=I.CARD_SHAPE||e.roundRect(0,-a,i[0]+1,a,this.round_radius,t.flags.collapsed?this.round_radius:0),e.fill(),e.shadowColor="transparent"}if(t.onDrawTitleBox?t.onDrawTitleBox(e,a,i,this.ds.scale):h==I.ROUND_SHAPE||h==I.CIRCLE_SHAPE||h==I.CARD_SHAPE?(l&&(e.fillStyle="black",e.beginPath(),e.arc(.5*a,-.5*a,6,0,2*Math.PI),e.fill()),e.fillStyle=t.boxcolor||I.NODE_DEFAULT_BOXCOLOR,e.beginPath(),e.arc(.5*a,-.5*a,5,0,2*Math.PI),e.fill()):(l&&(e.fillStyle="black",e.fillRect(.5*(a-10)-1,-.5*(a+10)-1,12,12)),e.fillStyle=t.boxcolor||I.NODE_DEFAULT_BOXCOLOR,e.fillRect(.5*(a-10),-.5*(a+10),10,10)),e.globalAlpha=d,t.onDrawTitleText&&t.onDrawTitleText(e,a,i,this.ds.scale,this.title_text_font,o),!l){e.font=this.title_text_font;var v=t.getTitle();if(v)if(e.fillStyle=o?"white":t.constructor.title_text_color||this.node_title_color,t.flags.collapsed){e.textAlign="center";var f=e.measureText(v);e.fillText(v,a+.5*f.width,I.NODE_TITLE_TEXT_Y-a),e.textAlign="left"}else e.textAlign="left",e.fillText(v,a,I.NODE_TITLE_TEXT_Y-a)}t.onDrawTitle&&t.onDrawTitle(e)}o&&(t.onBounding&&t.onBounding(c),u==I.TRANSPARENT_TITLE&&(c[1]-=a,c[3]+=a),e.lineWidth=1,e.globalAlpha=.8,e.beginPath(),h==I.BOX_SHAPE?e.rect(-6+c[0],-6+c[1],12+c[2],12+c[3]):h==I.ROUND_SHAPE||h==I.CARD_SHAPE&&t.flags.collapsed?e.roundRect(-6+c[0],-6+c[1],12+c[2],12+c[3],2*this.round_radius):h==I.CARD_SHAPE?e.roundRect(-6+c[0],-6+c[1],12+c[2],12+c[3],2*this.round_radius,2):h==I.CIRCLE_SHAPE&&e.arc(.5*i[0],.5*i[1],.5*i[0]+6,0,2*Math.PI),e.strokeStyle="#FFF",e.stroke(),e.strokeStyle=n,e.globalAlpha=1)};var T=new Float32Array(4),C=new Float32Array(4),N=new Float32Array(2),k=new Float32Array(2);function S(t,e){return Math.sqrt((e[0]-t[0])*(e[0]-t[0])+(e[1]-t[1])*(e[1]-t[1]))}function v(t,e,i,n,s,o){return i<t&&t<i+s&&n<e&&e<n+o}function w(t,e){var i=t[0]+t[2],n=t[1]+t[3],s=e[0]+e[2],o=e[1]+e[3];return!(t[0]>s||t[1]>o||i<e[0]||n<e[1])}function o(t,i){i=i||{},this.options=i;var e=this;i.parentMenu&&(i.parentMenu.constructor!==this.constructor?(console.error("parentMenu must be of class ContextMenu, ignoring it"),i.parentMenu=null):(this.parentMenu=i.parentMenu,this.parentMenu.lock=!0,this.parentMenu.current_submenu=this)),i.event&&i.event.constructor!==MouseEvent&&i.event.constructor!==CustomEvent&&(console.error("Event passed to ContextMenu is not of type MouseEvent or CustomEvent. Ignoring it."),i.event=null);var n=document.createElement("div");function s(t){var e=parseInt(n.style.top);return n.style.top=(e+t.deltaY*i.scroll_speed).toFixed()+"px",t.preventDefault(),!0}if(n.className="litegraph litecontextmenu litemenubar-panel",i.className&&(n.className+=" "+i.className),n.style.minWidth=100,n.style.minHeight=100,n.style.pointerEvents="none",setTimeout(function(){n.style.pointerEvents="auto"},100),n.addEventListener("mouseup",function(t){return t.preventDefault(),!0},!0),n.addEventListener("contextmenu",function(t){return 2!=t.button||t.preventDefault(),!1},!0),n.addEventListener("mousedown",function(t){if(2==t.button)return e.close(),t.preventDefault(),!0},!0),i.scroll_speed||(i.scroll_speed=.1),n.addEventListener("wheel",s,!0),n.addEventListener("mousewheel",s,!0),this.root=n,i.title){var o=document.createElement("div");o.className="litemenu-title",o.innerHTML=i.title,n.appendChild(o)}for(var r in t){var a=t.constructor==Array?t[r]:r;null!=a&&a.constructor!==String&&(a=void 0===a.content?String(a):a.content);var l=t[r];this.addItem(a,l,i),0}n.addEventListener("mouseleave",function(t){e.lock||(n.closing_timer&&clearTimeout(n.closing_timer),n.closing_timer=setTimeout(e.close.bind(e,t),500))}),n.addEventListener("mouseenter",function(t){n.closing_timer&&clearTimeout(n.closing_timer)});var h=document;i.event&&(h=i.event.target.ownerDocument),(h=h||document).body.appendChild(n);var u=i.left||0,p=i.top||0;if(i.event){if(u=i.event.clientX-10,p=i.event.clientY-10,i.title&&(p-=20),i.parentMenu){var c=i.parentMenu.root.getBoundingClientRect();u=c.left+c.width}var d=document.body.getBoundingClientRect(),g=n.getBoundingClientRect();u>d.width-g.width-10&&(u=d.width-g.width-10),p>d.height-g.height-10&&(p=d.height-g.height-10)}n.style.left=u+"px",n.style.top=p+"px",i.scale&&(n.style.transform="scale("+i.scale+")")}A.prototype.drawConnections=function(t){var e=I.getTime(),i=this.visible_area;T[0]=i[0]-20,T[1]=i[1]-20,T[2]=i[2]+40,T[3]=i[3]+40,t.lineWidth=this.connections_width,t.fillStyle="#AAA",t.strokeStyle="#AAA",t.globalAlpha=this.editor_alpha;for(var n=this.graph._nodes,s=0,o=n.length;s<o;++s){var r=n[s];if(r.inputs&&r.inputs.length)for(var a=0;a<r.inputs.length;++a){var l=r.inputs[a];if(l&&null!=l.link){var h=l.link,u=this.graph.links[h];if(u){var p=this.graph.getNodeById(u.origin_id);if(null!=p){var c=u.origin_slot,d=null;d=-1==c?[p.pos[0]+10,p.pos[1]+10]:p.getConnectionPos(!1,c,N);var g=r.getConnectionPos(!0,a,k);if(C[0]=d[0],C[1]=d[1],C[2]=g[0]-d[0],C[3]=g[1]-d[1],C[2]<0&&(C[0]+=C[2],C[2]=Math.abs(C[2])),C[3]<0&&(C[1]+=C[3],C[3]=Math.abs(C[3])),w(C,T)){var _=p.outputs[c],v=r.inputs[a];if(_&&v){var f=_.dir||(p.horizontal?I.DOWN:I.RIGHT),y=v.dir||(r.horizontal?I.UP:I.LEFT);if(this.renderLink(t,d,g,u,!1,0,null,f,y),u&&u._last_time&&e-u._last_time<1e3){var m=2-.002*(e-u._last_time),b=t.globalAlpha;t.globalAlpha=b*m,this.renderLink(t,d,g,u,!0,m,"white",f,y),t.globalAlpha=b}}}}}}}}t.globalAlpha=1},A.prototype.renderLink=function(t,e,i,n,s,o,r,a,l,h){n&&this.visible_links.push(n),!r&&n&&(r=n.color||A.link_type_colors[n.type]),r=r||this.default_link_color,null!=n&&this.highlighted_links[n.id]&&(r="#FFF"),a=a||I.RIGHT,l=l||I.LEFT;var u=S(e,i);this.render_connections_border&&.6<this.ds.scale&&(t.lineWidth=this.connections_width+4),t.lineJoin="round",1<(h=h||1)&&(t.lineWidth=.5),t.beginPath();for(var p=0;p<h;p+=1){var c=5*(p-.5*(h-1));if(this.links_render_mode==I.SPLINE_LINK){t.moveTo(e[0],e[1]+c);var d=0,g=0,_=0,v=0;switch(a){case I.LEFT:d=-.25*u;break;case I.RIGHT:d=.25*u;break;case I.UP:g=-.25*u;break;case I.DOWN:g=.25*u}switch(l){case I.LEFT:_=-.25*u;break;case I.RIGHT:_=.25*u;break;case I.UP:v=-.25*u;break;case I.DOWN:v=.25*u}t.bezierCurveTo(e[0]+d,e[1]+g+c,i[0]+_,i[1]+v+c,i[0],i[1]+c)}else if(this.links_render_mode==I.LINEAR_LINK){t.moveTo(e[0],e[1]+c);d=0,g=0,_=0,v=0;switch(a){case I.LEFT:d=-1;break;case I.RIGHT:d=1;break;case I.UP:g=-1;break;case I.DOWN:g=1}switch(l){case I.LEFT:_=-1;break;case I.RIGHT:_=1;break;case I.UP:v=-1;break;case I.DOWN:v=1}t.lineTo(e[0]+15*d,e[1]+15*g+c),t.lineTo(i[0]+15*_,i[1]+15*v+c),t.lineTo(i[0],i[1]+c)}else{if(this.links_render_mode!=I.STRAIGHT_LINK)return;t.moveTo(e[0],e[1]);var f=e[0],y=e[1],m=i[0],b=i[1];a==I.RIGHT?f+=10:y+=10,l==I.LEFT?m-=10:b-=10,t.lineTo(f,y),t.lineTo(.5*(f+m),y),t.lineTo(.5*(f+m),b),t.lineTo(m,b),t.lineTo(i[0],i[1])}}this.render_connections_border&&.6<this.ds.scale&&!s&&(t.strokeStyle="rgba(0,0,0,0.5)",t.stroke()),t.lineWidth=this.connections_width,t.fillStyle=t.strokeStyle=r,t.stroke();var E=this.computeConnectionPoint(e,i,.5,a,l);if(n&&n._pos&&(n._pos[0]=E[0],n._pos[1]=E[1]),.6<=this.ds.scale&&this.highquality_render&&l!=I.CENTER){if(this.render_connection_arrows){var T=this.computeConnectionPoint(e,i,.25,a,l),C=this.computeConnectionPoint(e,i,.26,a,l),N=this.computeConnectionPoint(e,i,.75,a,l),k=this.computeConnectionPoint(e,i,.76,a,l),w=0,O=0;O=this.render_curved_connections?(w=-Math.atan2(C[0]-T[0],C[1]-T[1]),-Math.atan2(k[0]-N[0],k[1]-N[1])):w=i[1]>e[1]?0:Math.PI,t.save(),t.translate(T[0],T[1]),t.rotate(w),t.beginPath(),t.moveTo(-5,-3),t.lineTo(0,7),t.lineTo(5,-3),t.fill(),t.restore(),t.save(),t.translate(N[0],N[1]),t.rotate(O),t.beginPath(),t.moveTo(-5,-3),t.lineTo(0,7),t.lineTo(5,-3),t.fill(),t.restore()}t.beginPath(),t.arc(E[0],E[1],5,0,2*Math.PI),t.fill()}if(o){t.fillStyle=r;for(p=0;p<5;++p){var D=(.001*I.getTime()+.2*p)%1;E=this.computeConnectionPoint(e,i,D,a,l);t.beginPath(),t.arc(E[0],E[1],5,0,2*Math.PI),t.fill()}}},A.prototype.computeConnectionPoint=function(t,e,i,n,s){n=n||I.RIGHT,s=s||I.LEFT;var o=S(t,e),r=t,a=[t[0],t[1]],l=[e[0],e[1]],h=e;switch(n){case I.LEFT:a[0]+=-.25*o;break;case I.RIGHT:a[0]+=.25*o;break;case I.UP:a[1]+=-.25*o;break;case I.DOWN:a[1]+=.25*o}switch(s){case I.LEFT:l[0]+=-.25*o;break;case I.RIGHT:l[0]+=.25*o;break;case I.UP:l[1]+=-.25*o;break;case I.DOWN:l[1]+=.25*o}var u=(1-i)*(1-i)*(1-i),p=(1-i)*(1-i)*3*i,c=3*(1-i)*(i*i),d=i*i*i;return[u*r[0]+p*a[0]+c*l[0]+d*h[0],u*r[1]+p*a[1]+c*l[1]+d*h[1]]},A.prototype.drawExecutionOrder=function(t){t.shadowColor="transparent",t.globalAlpha=.25,t.textAlign="center",t.strokeStyle="white",t.globalAlpha=.75;for(var e=this.visible_nodes,i=0;i<e.length;++i){var n=e[i];t.fillStyle="black",t.fillRect(n.pos[0]-I.NODE_TITLE_HEIGHT,n.pos[1]-I.NODE_TITLE_HEIGHT,I.NODE_TITLE_HEIGHT,I.NODE_TITLE_HEIGHT),0==n.order&&t.strokeRect(n.pos[0]-I.NODE_TITLE_HEIGHT+.5,n.pos[1]-I.NODE_TITLE_HEIGHT+.5,I.NODE_TITLE_HEIGHT,I.NODE_TITLE_HEIGHT),t.fillStyle="#FFF",t.fillText(n.order,n.pos[0]+-.5*I.NODE_TITLE_HEIGHT,n.pos[1]-6)}t.globalAlpha=1},A.prototype.drawNodeWidgets=function(t,e,i,n){if(!t.widgets||!t.widgets.length)return 0;var s=t.size[0],o=t.widgets;e+=2;var r=I.NODE_WIDGET_HEIGHT,a=.5<this.ds.scale;i.save(),i.globalAlpha=this.editor_alpha;for(var l="#666",h="#222",u=0;u<o.length;++u){var p=o[u],c=e;switch(p.y&&(c=p.y),p.last_y=c,i.strokeStyle=l,i.fillStyle="#222",i.textAlign="left",p.type){case"button":p.clicked&&(i.fillStyle="#AAA",p.clicked=!1,this.dirty_canvas=!0),i.fillRect(15,c,s-30,r),i.strokeRect(15,c,s-30,r),a&&(i.textAlign="center",i.fillStyle="#AAA",i.fillText(p.name,.5*s,c+.7*r));break;case"toggle":i.textAlign="left",i.strokeStyle=l,i.fillStyle=h,i.beginPath(),i.roundRect(15,e,s-30,r,.5*r),i.fill(),i.stroke(),i.fillStyle=p.value?"#89A":"#333",i.beginPath(),i.arc(s-30,c+.5*r,.36*r,0,2*Math.PI),i.fill(),a&&(i.fillStyle="#999",null!=p.name&&i.fillText(p.name,30,c+.7*r),i.fillStyle=p.value?"#DDD":"#888",i.textAlign="right",i.fillText(p.value?p.options.on||"true":p.options.off||"false",s-40,c+.7*r));break;case"slider":i.fillStyle=h,i.fillRect(15,c,s-30,r);var d=p.options.max-p.options.min,g=(p.value-p.options.min)/d;if(i.fillStyle=n==p?"#89A":"#678",i.fillRect(15,c,g*(s-30),r),i.strokeRect(15,c,s-30,r),p.marker){var _=(p.marker-p.options.min)/d;i.fillStyle="#AA9",i.fillRect(15+_*(s-30),c,2,r)}a&&(i.textAlign="center",i.fillStyle="#DDD",i.fillText(p.name+"  "+Number(p.value).toFixed(3),.5*s,c+.7*r));break;case"number":case"combo":i.textAlign="left",i.strokeStyle=l,i.fillStyle=h,i.beginPath(),i.roundRect(15,e,s-30,r,.5*r),i.fill(),i.stroke(),a&&(i.fillStyle="#AAA",i.beginPath(),i.moveTo(31,e+5),i.lineTo(21,e+.5*r),i.lineTo(31,e+r-5),i.moveTo(s-15-16,e+5),i.lineTo(s-15-6,e+.5*r),i.lineTo(s-15-16,e+r-5),i.fill(),i.fillStyle="#999",i.fillText(p.name,35,c+.7*r),i.fillStyle="#DDD",i.textAlign="right","number"==p.type?i.fillText(Number(p.value).toFixed(void 0!==p.options.precision?p.options.precision:3),s-30-20,c+.7*r):i.fillText(p.value,s-30-20,c+.7*r));break;case"string":case"text":i.textAlign="left",i.strokeStyle=l,i.fillStyle=h,i.beginPath(),i.roundRect(15,e,s-30,r,.5*r),i.fill(),i.stroke(),a&&(i.fillStyle="#999",null!=p.name&&i.fillText(p.name,30,c+.7*r),i.fillStyle="#DDD",i.textAlign="right",i.fillText(p.value,s-30,c+.7*r));break;default:p.draw&&p.draw(i,t,p,c,r)}e+=r+4}i.restore()},A.prototype.processNodeWidgets=function(i,n,s,t){if(!i.widgets||!i.widgets.length)return null;for(var e=n[0]-i.pos[0],o=n[1]-i.pos[1],r=i.size[0],a=this,l=this.getCanvasWindow(),h=0;h<i.widgets.length;++h){var u=i.widgets[h];if(u==t||6<e&&e<r-12&&o>u.last_y&&o<u.last_y+I.NODE_WIDGET_HEIGHT){switch(u.type){case"button":if("mousemove"===s.type)break;u.callback&&setTimeout(function(){u.callback(u,a,i,n)},20),u.clicked=!0,this.dirty_canvas=!0;break;case"slider":u.options.max,u.options.min;var p=Math.clamp((e-10)/(r-20),0,1);u.value=u.options.min+(u.options.max-u.options.min)*p,u.callback&&setTimeout(function(){v(u,u.value)},20),this.dirty_canvas=!0;break;case"number":case"combo":if("mousemove"==s.type&&"number"==u.type)u.value+=.1*s.deltaX*(u.options.step||1),null!=u.options.min&&u.value<u.options.min&&(u.value=u.options.min),null!=u.options.max&&u.value>u.options.max&&(u.value=u.options.max);else if("mousedown"==s.type){var c=u.options.values;c&&c.constructor===Function&&(c=u.options.values(u,i));var d=e<40?-1:r-40<e?1:0;if("number"==u.type)u.value+=.1*d*(u.options.step||1),null!=u.options.min&&u.value<u.options.min&&(u.value=u.options.min),null!=u.options.max&&u.value>u.options.max&&(u.value=u.options.max);else if(d){var g=c.indexOf(u.value)+d;g>=c.length&&(g=0),g<0&&(g=c.length-1),u.value=c[g]}else{new I.ContextMenu(c,{scale:Math.max(1,this.ds.scale),event:s,className:"dark",callback:_.bind(u)},l);function _(t,e,i){return this.value=t,v(this,t),!(a.dirty_canvas=!0)}}}setTimeout(function(){v(this,this.value)}.bind(u),20),this.dirty_canvas=!0;break;case"toggle":"mousedown"==s.type&&(u.value=!u.value,u.callback&&setTimeout(function(){v(u,u.value)},20));break;case"string":case"text":"mousedown"==s.type&&this.prompt("Texto",u.value,function(t){this.value=t,v(this,t)}.bind(u),s);break;default:u.mouse&&u.mouse(ctx,s,[e,o],i)}return u}}function v(t,e){t.value=e,t.property&&void 0!==i.properties[t.property]&&(i.properties[t.property]=e),t.callback&&t.callback(t.value,a,i,n,s)}return null},A.prototype.drawGroups=function(t,e){if(this.graph){var i=this.graph._groups;e.save(),e.globalAlpha=.5*this.editor_alpha;for(var n=0;n<i.length;++n){var s=i[n];if(w(this.visible_area,s._bounding)){e.fillStyle=s.color||"#335",e.strokeStyle=s.color||"#335";var o=s._pos,r=s._size;e.globalAlpha=.25*this.editor_alpha,e.beginPath(),e.rect(o[0]+.5,o[1]+.5,r[0],r[1]),e.fill(),e.globalAlpha=this.editor_alpha,e.stroke(),e.beginPath(),e.moveTo(o[0]+r[0],o[1]+r[1]),e.lineTo(o[0]+r[0]-10,o[1]+r[1]),e.lineTo(o[0]+r[0],o[1]+r[1]-10),e.fill();var a=s.font_size||I.DEFAULT_GROUP_FONT_SIZE;e.font=a+"px Arial",e.fillText(s.title,o[0]+4,o[1]+a)}}e.restore()}},A.prototype.adjustNodesSize=function(){for(var t=this.graph._nodes,e=0;e<t.length;++e)t[e].size=t[e].computeSize();this.setDirty(!0,!0)},A.prototype.resize=function(t,e){if(!t&&!e){var i=this.canvas.parentNode;t=i.offsetWidth,e=i.offsetHeight}this.canvas.width==t&&this.canvas.height==e||(this.canvas.width=t,this.canvas.height=e,this.bgcanvas.width=this.canvas.width,this.bgcanvas.height=this.canvas.height,this.setDirty(!0,!0))},A.prototype.switchLiveMode=function(t){if(!t)return this.live_mode=!this.live_mode,this.dirty_canvas=!0,void(this.dirty_bgcanvas=!0);var e=this,i=this.live_mode?1.1:.9;this.live_mode&&(this.live_mode=!1,this.editor_alpha=.1);var n=setInterval(function(){e.editor_alpha*=i,e.dirty_canvas=!0,e.dirty_bgcanvas=!0,i<1&&e.editor_alpha<.01&&(clearInterval(n),i<1&&(e.live_mode=!0)),1<i&&.99<e.editor_alpha&&(clearInterval(n),e.editor_alpha=1)},1)},A.prototype.onNodeSelectionChange=function(t){},A.prototype.touchHandler=function(t){var e=t.changedTouches[0],i="";switch(t.type){case"touchstart":i="mousedown";break;case"touchmove":i="mousemove";break;case"touchend":i="mouseup";break;default:return}var n=this.getCanvasWindow(),s=n.document.createEvent("MouseEvent");s.initMouseEvent(i,!0,!0,n,1,e.screenX,e.screenY,e.clientX,e.clientY,!1,!1,!1,!1,0,null),e.target.dispatchEvent(s),t.preventDefault()},A.onGroupAdd=function(t,e,i){var n=A.active_canvas,s=(n.getCanvasWindow(),new I.LGraphGroup);s.pos=n.convertEventToCanvasOffset(i),n.graph.add(s)},A.onMenuAdd=function(t,e,i,o){var a=A.active_canvas,l=a.getCanvasWindow(),n=I.getNodeTypesCategories(),s=[];for(var r in n)n[r]&&s.push({value:n[r],content:n[r],has_submenu:!0});var h=new I.ContextMenu(s,{event:i,callback:function(t,e,i){var n=t.value,s=I.getNodeTypesInCategory(n,a.filter),o=[];for(var r in s)s[r].skip_list||o.push({content:s[r].title,value:s[r].type});return new I.ContextMenu(o,{event:i,callback:u,parentMenu:h},l),!1},parentMenu:o},l);function u(t,e){if("Alfred"===t.content)for(var i in p.graph._nodes)if(p.graph._nodes[i].title===t.content)return;var n=o.getFirstEvent(),s=I.createNode(t.value);s&&(s.pos=a.convertEventToCanvasOffset(n),a.graph.add(s))}return!1},A.onMenuCollapseAll=function(){},A.onMenuNodeEdit=function(){},A.showMenuNodeOptionalInputs=function(t,e,i,n,s){if(s){var o=this,r=A.active_canvas.getCanvasWindow();e=s.optional_inputs;s.onGetInputs&&(e=s.onGetInputs());var a=[];if(e)for(var l in e){var h=e[l];if(h){var u=h[0];h[2]&&h[2].label&&(u=h[2].label);var p={content:u,value:h};h[1]==I.ACTION&&(p.className="event"),a.push(p)}else a.push(null)}if(this.onMenuNodeInputs&&(a=this.onMenuNodeInputs(a)),a.length){new I.ContextMenu(a,{event:i,callback:function(t,e,i){if(!s)return;t.callback&&t.callback.call(o,s,t,e,i);t.value&&(s.addInput(t.value[0],t.value[1],t.value[2]),s.setDirtyCanvas(!0,!0))},parentMenu:n,node:s},r);return!1}}},A.showMenuNodeOptionalOutputs=function(t,e,i,a,l){if(l){var h=this,n=A.active_canvas.getCanvasWindow();e=l.optional_outputs;l.onGetOutputs&&(e=l.onGetOutputs());var s=[];if(e)for(var o in e){var r=e[o];if(r){if(!l.flags||!l.flags.skip_repeated_outputs||-1==l.findOutputSlot(r[0])){var u=r[0];r[2]&&r[2].label&&(u=r[2].label);var p={content:u,value:r};r[1]==I.EVENT&&(p.className="event"),s.push(p)}}else s.push(null)}if(this.onMenuNodeOutputs&&(s=this.onMenuNodeOutputs(s)),s.length){new I.ContextMenu(s,{event:i,callback:function t(e,i,n){if(!l)return;e.callback&&e.callback.call(h,l,e,i,n);if(!e.value)return;var s=e.value[1];{if(s&&(s.constructor===Object||s.constructor===Array)){var o=[];for(var r in s)o.push({content:r,value:s[r]});return new I.ContextMenu(o,{event:i,callback:t,parentMenu:a,node:l}),!1}l.addOutput(e.value[0],e.value[1],e.value[2]),l.setDirtyCanvas(!0,!0)}},parentMenu:a,node:l},n);return!1}}},A.onShowMenuNodeProperties=function(t,e,i,n,o){if(o&&o.properties){var r=A.active_canvas,s=r.getCanvasWindow(),a=[];for(var l in o.properties){t=void 0!==o.properties[l]?o.properties[l]:" ";t=A.decodeHTML(t),a.push({content:"<span class='property_name' style='color: #aaa;'>"+l+"</span><span class='property_value'>"+t+"</span>",value:l})}if(a.length){new I.ContextMenu(a,{event:i,callback:function(t,e,i,n){if(!o)return;var s=this.getBoundingClientRect();r.showEditPropertyValue(o,t.value,{position:[s.left,s.top]})},parentMenu:n,allow_html:!0,node:o},s);return!1}}},A.decodeHTML=function(t){var e=document.createElement("div");return e.innerText=t,e.innerHTML},A.onResizeNode=function(t,e,i,n,s){s&&(s.size=s.computeSize(),s.setDirtyCanvas(!0,!0))},A.prototype.showLinkMenu=function(e,t){var i=this;return new I.ContextMenu(["Delete"],{event:t,callback:function(t){switch(t){case"Delete":i.graph.removeLink(e.id)}}}),!1},A.onShowPropertyEditor=function(e,t,i,n,s){var o=e.property||"title",r=s[o],a=document.createElement("div");a.className="graphdialog",a.innerHTML="<span class='name' style='color: #aaa;'></span><input autofocus type='text' class='value'/><button>OK</button>",a.querySelector(".name").innerText=o;var l=a.querySelector("input");l&&(l.value=r,l.addEventListener("blur",function(t){this.focus()}),l.addEventListener("keydown",function(t){13==t.keyCode&&(d(),t.preventDefault(),t.stopPropagation())}));var h=A.active_canvas.canvas,u=h.getBoundingClientRect(),p=-20,c=-20;function d(){!function(t){"Number"==e.type?t=Number(t):"Boolean"==e.type&&(t=Boolean(t));s[o]=t,a.parentNode&&a.parentNode.removeChild(a);s.setDirtyCanvas(!0,!0)}(l.value)}u&&(p-=u.left,c-=u.top),event?(a.style.left=event.clientX+p+"px",a.style.top=event.clientY+c+"px"):(a.style.left=.5*h.width+p+"px",a.style.top=.5*h.height+c+"px"),a.querySelector("button").addEventListener("click",d),h.parentNode.appendChild(a)},A.prototype.prompt=function(t,e,i,n){var s=this;t=t||"";var o=!1,r=document.createElement("div");r.className="graphdialog rounded",r.innerHTML="<span class='name' style='color: #aaa;'></span> <input autofocus type='text' class='value'/><button class='rounded'>OK</button>",r.close=function(){s.prompt_box=null,r.parentNode&&r.parentNode.removeChild(r)},1<this.ds.scale&&(r.style.transform="scale("+this.ds.scale+")"),r.addEventListener("mouseleave",function(t){o||r.close()}),s.prompt_box&&s.prompt_box.close();(s.prompt_box=r).querySelector(".name").innerText=t,r.querySelector(".value").value=e;var a=r.querySelector("input");a.addEventListener("keydown",function(t){if(o=!0,27==t.keyCode)r.close();else{if(13!=t.keyCode)return;i&&i(this.value),r.close()}t.preventDefault(),t.stopPropagation()}),r.querySelector("button").addEventListener("click",function(t){i&&i(a.value),s.setDirty(!0),r.close()});var l=A.active_canvas.canvas,h=l.getBoundingClientRect(),u=-20,p=-20;return h&&(u-=h.left,p-=h.top),n?(r.style.left=n.clientX+u+"px",r.style.top=n.clientY+p+"px"):(r.style.left=.5*l.width+u+"px",r.style.top=.5*l.height+p+"px"),l.parentNode.appendChild(r),setTimeout(function(){a.focus()},10),r},A.search_limit=-1,A.prototype.showSearchBox=function(s){var a=this,o=document.createElement("div");o.className="litegraph litesearchbox graphdialog rounded",o.innerHTML="<span class='name' style='color: #aaa;'>Search</span> <input autofocus type='text' class='value rounded'/><div class='helper'></div>",o.close=function(){a.search_box=null,document.body.focus(),setTimeout(function(){a.canvas.focus()},20),o.parentNode&&o.parentNode.removeChild(o)};var e=null;1<this.ds.scale&&(o.style.transform="scale("+this.ds.scale+")"),o.addEventListener("mouseenter",function(t){e&&(clearTimeout(e),e=null)}),o.addEventListener("mouseleave",function(t){e=setTimeout(function(){o.close()},500)}),a.search_box&&a.search_box.close();var l=(a.search_box=o).querySelector(".helper"),h=null,u=null,i=null,p=o.querySelector("input");p&&(p.addEventListener("blur",function(t){this.focus()}),p.addEventListener("keydown",function(t){if(38==t.keyCode)_(!1);else if(40==t.keyCode)_(!0);else if(27==t.keyCode)o.close();else{if(13!=t.keyCode)return u&&clearInterval(u),void(u=setTimeout(v,10));i?g(i.innerHTML):h?g(h):o.close()}t.preventDefault(),t.stopPropagation()}));var c=A.active_canvas,t=c.canvas,n=t.getBoundingClientRect(),r=-20,d=-20;function g(t){if(t)if(a.onSearchBoxSelection)a.onSearchBoxSelection(t,s,c);else{var e=I.searchbox_extras[t.toLowerCase()];e&&(t=e.type);var i=I.createNode(t);if(i&&(i.pos=c.convertEventToCanvasOffset(s),c.graph.add(i)),e&&e.data){if(e.data.properties)for(var n in e.data.properties)i.addProperty(n,e.data.properties[n]);if(e.data.inputs)for(var n in i.inputs=[],e.data.inputs)i.addOutput(e.data.inputs[n][0],e.data.inputs[n][1]);if(e.data.outputs)for(var n in i.outputs=[],e.data.outputs)i.addOutput(e.data.outputs[n][0],e.data.outputs[n][1]);e.data.title&&(i.title=e.data.title),e.data.json&&i.configure(e.data.json)}}o.close()}function _(t){var e=i;i&&i.classList.remove("selected"),(i=i?(i=t?i.nextSibling:i.previousSibling)||e:t?l.childNodes[0]:l.childNodes[l.childNodes.length])&&(i.classList.add("selected"),i.scrollIntoView())}function v(){u=null;var e=p.value;if(h=null,l.innerHTML="",e)if(a.onSearchBox){var t=a.onSearchBox(l,e,c);if(t)for(var i=0;i<t.length;++i)r(t[i])}else{var n=0;for(var i in e=e.toLowerCase(),I.searchbox_extras){var s=I.searchbox_extras[i];if(-1!==s.desc.toLowerCase().indexOf(e)&&(r(s.desc,"searchbox_extra"),-1!==A.search_limit&&n++>A.search_limit))break}if(Array.prototype.filter){var o=Object.keys(I.registered_node_types).filter(function(t){return-1!==t.toLowerCase().indexOf(e)});for(i=0;i<o.length&&(r(o[i]),!(-1!==A.search_limit&&n++>A.search_limit));i++);}else for(var i in I.registered_node_types)if(-1!=i.indexOf(e)&&(r(i),-1!==A.search_limit&&n++>A.search_limit))break}function r(t,e){var i=document.createElement("div");h=h||t,i.innerText=t,i.dataset.type=escape(t),i.className="litegraph lite-search-item",e&&(i.className+=" "+e),i.addEventListener("click",function(t){g(unescape(this.dataset.type))}),l.appendChild(i)}}return n&&(r-=n.left,d-=n.top),s?(o.style.left=s.clientX+r+"px",o.style.top=s.clientY+d+"px"):(o.style.left=.5*t.width+r+"px",o.style.top=.5*t.height+d+"px"),t.parentNode.appendChild(o),p.focus(),o},A.prototype.showEditPropertyValue=function(e,i,t){if(e&&void 0!==e.properties[i]){t=t||{};var n="string";null!==e.properties[i]&&(n=typeof e.properties[i]),"object"==n&&e.properties[i].length&&(n="array");var s=null;if(e.getPropertyInfo&&(s=e.getPropertyInfo(i)),e.properties_info)for(var o=0;o<e.properties_info.length;++o)if(e.properties_info[o].name==i){s=e.properties_info[o];break}null!=s&&s.type&&(n=s.type);var r="";if("string"==n||"number"==n||"array"==n)r="<input autofocus type='text' class='value'/>";else if("enum"==n&&s.values){for(var o in r="<select autofocus type='text' class='value'>",s.values){var a=s.values.constructor===Array?s.values[o]:o;r+="<option value='"+a+"' "+(a==e.properties[i]?"selected":"")+">"+s.values[o]+"</option>"}r+="</select>"}else{if("boolean"!=n)return void console.warn("unknown type: "+n);r="<input autofocus type='checkbox' class='value' "+(e.properties[i]?"checked":"")+"/>"}var l=this.createDialog("<span class='name' style='color: #aaa;'>"+i+"</span>"+r+"<button>OK</button>",t);if("enum"==n&&s.values)(h=l.querySelector("select")).addEventListener("change",function(t){p(t.target.value)});else if("boolean"==n){(h=l.querySelector("input"))&&h.addEventListener("click",function(t){p(!!h.checked)})}else{var h;(h=l.querySelector("input"))&&(h.addEventListener("blur",function(t){this.focus()}),h.value=void 0!==e.properties[i]?e.properties[i]:"",h.addEventListener("keydown",function(t){13==t.keyCode&&(u(),t.preventDefault(),t.stopPropagation())}))}l.querySelector("button").addEventListener("click",u)}function u(){p(h.value)}function p(t){"number"==typeof e.properties[i]&&(t=Number(t)),"array"==n&&(t=t.split(",").map(Number)),e.properties[i]=t,e._graph&&e._graph._version++,e.onPropertyChanged&&e.onPropertyChanged(i,t),l.close(),e.setDirtyCanvas(!0,!0)}},A.prototype.createDialog=function(t,e){e=e||{};var i=document.createElement("div");i.className="graphdialog",i.innerHTML=t;var n=this.canvas.getBoundingClientRect(),s=-20,o=-20;return n&&(s-=n.left,o-=n.top),e.position?(s+=e.position[0],o+=e.position[1]):e.event?(s+=e.event.clientX,o+=e.event.clientY):(s+=.5*this.canvas.width,o+=.5*this.canvas.height),i.style.left=s+"px",i.style.top=o+"px",this.canvas.parentNode.appendChild(i),i.close=function(){this.parentNode&&this.parentNode.removeChild(this)},i},A.onMenuNodeCollapse=function(t,e,i,n,s){s.collapse()},A.onMenuNodePin=function(t,e,i,n,s){s.pin()},A.onMenuNodeMode=function(t,e,i,n,s){return new I.ContextMenu(["Always","On Event","On Trigger","Never"],{event:i,callback:function(t){if(!s)return;switch(t){case"On Event":s.mode=I.ON_EVENT;break;case"On Trigger":s.mode=I.ON_TRIGGER;break;case"Never":s.mode=I.NEVER;break;case"Always":default:s.mode=I.ALWAYS}},parentMenu:n,node:s}),!1},A.onMenuNodeColors=function(t,e,i,n,s){if(!s)throw"no node for color";var o=[];for(var r in o.push({value:null,content:"<span style='display: block; padding-left: 4px; color: #aaa;'>No color</span>"}),A.node_colors){var a=A.node_colors[r];t={value:r,content:"<span style='display: block; color: #aaa; padding-left: 4px; border-left: 8px solid ; color: #aaa"+a.color+"; background-color:"+a.bgcolor+"'>"+r+"</span>"};o.push(t)}return new I.ContextMenu(o,{event:i,callback:function(t){if(!s)return;var e=t.value?A.node_colors[t.value]:null;e?s.constructor===I.LGraphGroup?s.color=e.groupcolor:(s.color=e.color,s.bgcolor=e.bgcolor):(delete s.color,delete s.bgcolor);s.setDirtyCanvas(!0,!0)},parentMenu:n,node:s}),!1},A.onMenuNodeShapes=function(t,e,i,n,s){if(!s)throw"no node passed";return new I.ContextMenu(I.VALID_SHAPES,{event:i,callback:function(t){if(!s)return;s.shape=t,s.setDirtyCanvas(!0)},parentMenu:n,node:s}),!1},A.onMenuNodeRemove=function(t,e,i,n,s){if(!s)throw"no node passed";!1!==s.removable&&(s.graph.remove(s),s.setDirtyCanvas(!0,!0))},A.onMenuNodeClone=function(t,e,i,n,s){if(0!=s.clonable){var o=s.clone();o&&(o.pos=[s.pos[0]+5,s.pos[1]+5],s.graph.add(o),s.setDirtyCanvas(!0,!0))}},A.node_colors={red:{color:"#322",bgcolor:"#533",groupcolor:"#A88"},brown:{color:"#332922",bgcolor:"#593930",groupcolor:"#b06634"},green:{color:"#232",bgcolor:"#353",groupcolor:"#8A8"},blue:{color:"#223",bgcolor:"#335",groupcolor:"#88A"},pale_blue:{color:"#2a363b",bgcolor:"#3f5159",groupcolor:"#3f789e"},cyan:{color:"#233",bgcolor:"#355",groupcolor:"#8AA"},purple:{color:"#323",bgcolor:"#535",groupcolor:"#a1309b"},yellow:{color:"#432",bgcolor:"#653",groupcolor:"#b58b2a"},black:{color:"#222",bgcolor:"#000",groupcolor:"#444"}},A.prototype.getCanvasMenuOptions=function(){var t=null;if(this.getMenuOptions?t=this.getMenuOptions():(t=[{content:"Add Node",has_submenu:!0,callback:A.onMenuAdd},{content:"Add Group",callback:A.onGroupAdd}],this._graph_stack&&0<this._graph_stack.length&&t.push(null,{content:"Close subgraph",callback:this.closeSubgraph.bind(this)})),this.getExtraMenuOptions){var e=this.getExtraMenuOptions(this,t);e&&(t=t.concat(e))}return t},A.prototype.getNodeMenuOptions=function(t){var e=null;if(e=t.getMenuOptions?t.getMenuOptions(this):[{content:"Inputs",has_submenu:!0,disabled:!0,callback:A.showMenuNodeOptionalInputs},{content:"Outputs",has_submenu:!0,disabled:!0,callback:A.showMenuNodeOptionalOutputs},null,{content:"Properties",has_submenu:!0,callback:A.onShowMenuNodeProperties},null,{content:"Title",callback:A.onShowPropertyEditor},{content:"Mode",has_submenu:!0,callback:A.onMenuNodeMode},{content:"Resize",callback:A.onResizeNode},{content:"Collapse",callback:A.onMenuNodeCollapse},{content:"Pin",callback:A.onMenuNodePin},{content:"Colors",has_submenu:!0,callback:A.onMenuNodeColors},{content:"Shapes",has_submenu:!0,callback:A.onMenuNodeShapes},null],t.onGetInputs){var i=t.onGetInputs();i&&i.length&&(e[0].disabled=!1)}if(t.onGetOutputs){var n=t.onGetOutputs();n&&n.length&&(e[1].disabled=!1)}if(t.getExtraMenuOptions){var s=t.getExtraMenuOptions(this);s&&(s.push(null),e=s.concat(e))}return!1!==t.clonable&&e.push({content:"Clone",callback:A.onMenuNodeClone}),!1!==t.removable&&e.push(null,{content:"Remove",callback:A.onMenuNodeRemove}),t.graph&&t.graph.onGetNodeMenuOptions&&t.graph.onGetNodeMenuOptions(e,t),e},A.prototype.getGroupMenuOptions=function(t){return[{content:"Title",callback:A.onShowPropertyEditor},{content:"Color",has_submenu:!0,callback:A.onMenuNodeColors},{content:"Font size",property:"font_size",type:"Number",callback:A.onShowPropertyEditor},null,{content:"Remove",callback:A.onMenuNodeRemove}]},A.prototype.processContextMenu=function(a,t){var l=this,e=A.active_canvas.getCanvasWindow(),i=null,n={event:t,callback:function(t,e,i){if(!t)return;{if("Remove Slot"==t.content)return void((n=t.slot).input?a.removeInput(n.slot):n.output&&a.removeOutput(n.slot));if("Disconnect Links"==t.content)return void((n=t.slot).output?a.disconnectOutput(n.slot):n.input&&a.disconnectInput(n.slot));if("Rename Slot"==t.content){var n,s=(n=t.slot).input?a.getInputInfo(n.slot):a.getOutputInfo(n.slot),o=l.createDialog("<span class='name' style='color: #aaa;'>Name</span><input autofocus type='text'/><button>OK</button>",e),r=o.querySelector("input");r&&s&&(r.value=s.label||""),o.querySelector("button").addEventListener("click",function(t){r.value&&(s&&(s.label=r.value),l.setDirty(!0)),o.close()})}}},extra:a},s=null;if(a&&(s=a.getSlotInPosition(t.canvasX,t.canvasY),A.active_node=a),s){i=[],s&&s.output&&s.output.links&&s.output.links.length&&i.push({content:"Disconnect Links",slot:s});var o=s.input||s.output;i.push(o.locked?"Cannot remove":{content:"Remove Slot",slot:s}),i.push(o.nameLocked?"Cannot rename":{content:"Rename Slot",slot:s}),n.title=(s.input?s.input.type:s.output.type)||"*",s.input&&s.input.type==I.ACTION&&(n.title="Action"),s.output&&s.output.type==I.EVENT&&(n.title="Event")}else if(a)i=this.getNodeMenuOptions(a);else{i=this.getCanvasMenuOptions();var r=this.graph.getGroupOnPos(t.canvasX,t.canvasY);r&&i.push(null,{content:"Edit Group",has_submenu:!0,submenu:{title:"Group",extra:r,options:this.getGroupMenuOptions(r)}})}if(i)new I.ContextMenu(i,n,e)},this.CanvasRenderingContext2D&&(CanvasRenderingContext2D.prototype.roundRect=function(t,e,i,n,s,o){void 0===s&&(s=5),void 0===o&&(o=s),this.moveTo(t+s,e),this.lineTo(t+i-s,e),this.quadraticCurveTo(t+i,e,t+i,e+s),this.lineTo(t+i,e+n-o),this.quadraticCurveTo(t+i,e+n,t+i-o,e+n),this.lineTo(t+o,e+n),this.quadraticCurveTo(t,e+n,t,e+n-o),this.lineTo(t,e+s),this.quadraticCurveTo(t,e,t+s,e)}),I.compareObjects=function(t,e){for(var i in t)if(t[i]!=e[i])return!1;return!0},I.distance=S,I.colorToString=function(t){return"rgba("+Math.round(255*t[0]).toFixed()+","+Math.round(255*t[1]).toFixed()+","+Math.round(255*t[2]).toFixed()+","+(4==t.length?t[3].toFixed(2):"1.0")+")"},I.isInsideRectangle=v,I.growBounding=function(t,e,i){e<t[0]?t[0]=e:e>t[2]&&(t[2]=e),i<t[1]?t[1]=i:i>t[3]&&(t[3]=i)},I.isInsideBounding=function(t,e){return!(t[0]<e[0][0]||t[1]<e[0][1]||t[0]>e[1][0]||t[1]>e[1][1])},I.overlapBounding=w,I.hex2num=function(t){"#"==t.charAt(0)&&(t=t.slice(1)),t=t.toUpperCase();for(var e,i,n="0123456789ABCDEF",s=new Array(3),o=0,r=0;r<6;r+=2)e=n.indexOf(t.charAt(r)),i=n.indexOf(t.charAt(r+1)),s[o]=16*e+i,o++;return s},I.num2hex=function(t){for(var e,i,n="0123456789ABCDEF",s="#",o=0;o<3;o++)e=t[o]/16,i=t[o]%16,s+=n.charAt(e)+n.charAt(i);return s},o.prototype.addItem=function(t,e,n){var s=this;n=n||{};var i=document.createElement("div"),o=!(i.className="litemenu-entry submenu");function r(t){var e=this.value,i=!0;s.current_submenu&&s.current_submenu.close(t),!n.callback||!0===n.callback.call(this,e,n,t,s,n.node)&&(i=!1);if(e){if(e.callback&&!n.ignore_item_callbacks&&!0!==e.disabled)!0===e.callback.call(this,e,n,t,s,n.extra)&&(i=!1);if(e.submenu){if(!e.submenu.options)throw"ContextMenu submenu needs options";new s.constructor(e.submenu.options,{callback:e.submenu.callback,event:t,parentMenu:s,ignore_item_callbacks:e.submenu.ignore_item_callbacks,title:e.submenu.title,extra:e.submenu.extra,autoopen:n.autoopen});i=!1}}i&&!s.lock&&s.close()}return null===e?i.classList.add("separator"):(i.innerHTML=e&&e.title?e.title:t,(i.value=e)&&(e.disabled&&(o=!0,i.classList.add("disabled")),(e.submenu||e.has_submenu)&&i.classList.add("has_submenu")),"function"==typeof e?(i.dataset.value=t,i.onclick_callback=e):i.dataset.value=e,e.className&&(i.className+=" "+e.className)),this.root.appendChild(i),o||i.addEventListener("click",r),n.autoopen&&i.addEventListener("mouseenter",function(t){var e=this.value;if(!e||!e.has_submenu)return;r.call(this,t)}),i},o.prototype.close=function(t,e){this.root.parentNode&&this.root.parentNode.removeChild(this.root),this.parentMenu&&!e&&(this.parentMenu.lock=!1,this.parentMenu.current_submenu=null,void 0===t?this.parentMenu.close():t&&!o.isCursorOverElement(t,this.parentMenu.root)&&o.trigger(this.parentMenu.root,"mouseleave",t)),this.current_submenu&&this.current_submenu.close(t,!0),this.root.closing_timer&&clearTimeout(this.root.closing_timer)},o.trigger=function(t,e,i,n){var s=document.createEvent("CustomEvent");return s.initCustomEvent(e,!0,!0,i),s.srcElement=n,t.dispatchEvent?t.dispatchEvent(s):t.__events&&t.__events.dispatchEvent(s),s},o.prototype.getTopMenu=function(){return this.options.parentMenu?this.options.parentMenu.getTopMenu():this},o.prototype.getFirstEvent=function(){return this.options.parentMenu?this.options.parentMenu.getFirstEvent():this.options.event},o.isCursorOverElement=function(t,e){var i=t.clientX,n=t.clientY,s=e.getBoundingClientRect();return!!s&&(n>s.top&&n<s.top+s.height&&i>s.left&&i<s.left+s.width)},I.ContextMenu=o,I.closeAllContextMenus=function(t){var e=(t=t||window).document.querySelectorAll(".litecontextmenu");if(e.length){for(var i=[],n=0;n<e.length;n++)i.push(e[n]);for(var n in i)i[n].close?i[n].close():i[n].parentNode&&i[n].parentNode.removeChild(i[n])}},I.extendClass=function(t,e){for(var i in e)t.hasOwnProperty(i)||(t[i]=e[i]);if(e.prototype)for(var i in e.prototype)e.prototype.hasOwnProperty(i)&&(t.prototype.hasOwnProperty(i)||(e.prototype.__lookupGetter__(i)?t.prototype.__defineGetter__(i,e.prototype.__lookupGetter__(i)):t.prototype[i]=e.prototype[i],e.prototype.__lookupSetter__(i)&&t.prototype.__defineSetter__(i,e.prototype.__lookupSetter__(i))))},I.getParameterNames=function(t){return(t+"").replace(/[/][/].*$/gm,"").replace(/\s+/g,"").replace(/[/][*][^/*]*[*][/]/g,"").split("){",1)[0].replace(/^[^(]*[(]/,"").replace(/=[^,]+/g,"").split(",").filter(Boolean)},Math.clamp=function(t,e,i){return t<e?e:i<t?i:t},"undefined"==typeof window||window.requestAnimationFrame||(window.requestAnimationFrame=window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||function(t){window.setTimeout(t,1e3/60)})}(this),"undefined"!=typeof exports&&(exports.LiteGraph=this.LiteGraph),LiteGraph.debug=!1;var graphcanvas=document.createElement("canvas");graphcanvas.setAttribute("id","graphcanvas"),document.body.append(graphcanvas);var graph=new LGraph,canvas=new LGraphCanvas("#graphcanvas",graph);canvas.resize(1920,1080),graph.start();var variables_table={};function Alfred(){this.addWidget("button","Empezar",null,this.start.bind(this)),this.addOutput("Inicio",LiteGraph.EVENT)}function Mostrar(){this.size=[60,20],this.value="",this.addInput("Texto","",{label:""})}function Variable(){this.addInput("",LiteGraph.ACTION),this.addInput("Nombre",""),this.addInput("Valor",0),this.addOutput("",LiteGraph.EVENT),this.addOutput("Valor",0)}function Booleano(){this.addOutput("",!1),this.size=[133,48],this.widget=this.addWidget("toggle","Valor",null,this.setValue.bind(this)),this.widgets_up=!0,this.addProperty("valor",!1)}function Numero(){this.addOutput("",""),this.size=[90,60],this.properties={valor:1,pasos:1},this._remainder=0,this._precision=0,this._old_y=-1,this._mouse_captured=!1}function Texto(){this.addOutput("",""),this.size=[100,30],this.widget=this.addWidget("text","","",this.setValue.bind(this)),this.widgets_up=!0,this.addProperty("texto","")}function Condicional(){this.addInput("",LiteGraph.ACTION),this.addInput("Valor",0),this.addOutput("Verdadero",LiteGraph.EVENT),this.addOutput("Falso",LiteGraph.EVENT)}function Siempre(){this.addOutput("",LiteGraph.EVENT)}function Comparar(){this.addInput("",LiteGraph.ACTION),this.addInput("A",void 0),this.addInput("B",void 0),this.addOutput("",LiteGraph.EVENT),this.addOutput("Resultado",void 0)}function Matematicas(){this.op=this.addWidget("combo","","+",function(){},{values:["+","-","*","/","^","%"]}),this.addInput("",LiteGraph.ACTION),this.addInput("A",void 0),this.addInput("B",void 0),this.addOutput("",LiteGraph.EVENT),this.addOutput("=",0)}function HeSidoHackeado(){this.demo_email="correo@gmail.com",this.API="https://haveibeenpwned.com/api/v2/breachedaccount/",this.email_widget=this.addWidget("text","Email",this.demo_email,function(){}),this.addInput("",LiteGraph.ACTION),this.addInput("Email",this.demo_email),this.addOutput("",LiteGraph.EVENT),this.addOutput("Resultado",void 0),this.addOutput("Cuentas hackeadas",void 0)}if(Alfred.title="Alfred",Alfred.desc="Panel de control",Alfred.prototype.start=function(){this.triggerSlot(0,"inicio")},LiteGraph.registerNodeType("Básico/Alfred",Alfred),Mostrar.title="Mostrar",Mostrar.desc="Muestra el valor de la entrada",Mostrar.prototype.onExecute=function(){this.inputs[0]&&(this.value=this.getInputData(0))},Mostrar.prototype.getTitle=function(){return this.flags.collapsed?this.inputs[0].label:this.title},Mostrar.toString=function(t){if(null==t)return"- -";if(t.constructor===Number)return t.toFixed(6);if(t.constructor===Boolean)return t?"Verdadero":"Falso";if(t.constructor===Array){for(var e="[",i=0;i<t.length;++i)e+=Mostrar.toString(t[i])+(i+1!=t.length?",":"");return e+="]"}if(t.constructor!==Object)return String(t);var n=JSON.stringify(t);return 100<n.length&&(console.log(t),n="<JSON>"),n},Mostrar.prototype.onDrawBackground=function(t){this.inputs[0].label=Mostrar.toString(this.value)},LiteGraph.registerNodeType("Básico/Mostrar",Mostrar),Variable.title="Variable",Variable.desc="Asigna un nombre a un valor",Variable.prototype.getTitle=function(){if(this.flags.collapsed){var t=this.getInputData(1);return t||"< Variable >"}return this.title},Variable.prototype.onAction=function(){var t=this.getInputData(1),e=this.getInputData(2);t&&void 0!==e&&(variables_table[t]=e),t&&void 0!==variables_table[t]&&(this.setOutputData(1,variables_table[t]),this.triggerSlot(0,"variable"))},LiteGraph.registerNodeType("Básico/Variable",Variable),Booleano.title="Booleano",Booleano.desc="Crea un texto",Booleano.prototype.onExecute=function(){this.setOutputData(0,this.properties.valor)},Booleano.prototype.getTitle=function(){return this.flags.collapsed?this.properties.valor?"Verdadero":"Falso":this.title},Booleano.prototype.onPropertyChanged=function(t,e){this.widget.value=e},Booleano.prototype.setValue=function(t){this.properties.valor=t},LiteGraph.registerNodeType("Constante/Booleano",Booleano),Numero.title="Número",Numero.desc="Genera un número constante",Numero.pixels_threshold=10,Numero.markers_color="#666",Numero.prototype.onExecute=function(){this.setOutputData(0,this.properties.valor)},Numero.prototype.getTitle=function(){return this.flags.collapsed?this.properties.valor.toFixed(this._precision):this.title},Numero.prototype.onDrawForeground=function(t){if(!this.flags.collapsed){var e=.5*this.size[0],i=this.size[1];30<i&&(t.fillStyle=Numero.markers_color,t.beginPath(),t.moveTo(e,.1*i),t.lineTo(e+.1*i,.2*i),t.lineTo(e+-.1*i,.2*i),t.fill(),t.beginPath(),t.moveTo(e,.9*i),t.lineTo(e+.1*i,.8*i),t.lineTo(e+-.1*i,.8*i),t.fill()),t.font=(.6*i).toFixed(1)+"px Arial",t.textAlign="center",t.font=(.5*i).toFixed(1)+"px Arial",t.fillStyle="#EEE",t.fillText(this.properties.valor.toFixed(this._precision),e,.68*i)}},Numero.prototype.onPropertyChanged=function(t,e){var i=(this.properties.pasos+"").split(".");this._precision=1<i.length?i[1].length:0},Numero.prototype.onMouseDown=function(t,e){if(!(e[1]<0))return this._old_y=t.canvasY,this.captureInput(!0),this._mouse_captured=!0},Numero.prototype.onMouseMove=function(t){if(this._mouse_captured){var e=this._old_y-t.canvasY;t.shiftKey&&(e*=10),(t.metaKey||t.altKey)&&(e*=.1),this._old_y=t.canvasY;var i=this._remainder+e/Numero.pixels_threshold;this._remainder=i%1,i|=0;var n=Math.clamp(this.properties.valor+i*this.properties.pasos,Number.MIN_SAFE_INTEGER,Number.MAX_SAFE_INTEGER);this.properties.valor=n,this.graph._version++,this.setDirtyCanvas(!0)}},Numero.prototype.onMouseUp=function(t,e){if(t.click_time<200){var i=e[1]>.5*this.size[1]?-1:1;this.properties.valor=Math.clamp(this.properties.valor+i*this.properties.pasos,Number.MIN_SAFE_INTEGER,Number.MAX_SAFE_INTEGER),this.graph._version++,this.setDirtyCanvas(!0)}this._mouse_captured&&(this._mouse_captured=!1,this.captureInput(!1))},LiteGraph.registerNodeType("Constante/Número",Numero),Texto.title="Texto",Texto.desc="Crea un texto",Texto.prototype.onExecute=function(){this.setOutputData(0,this.properties.texto)},Texto.prototype.getTitle=function(){return this.flags.collapsed?this.properties.texto:this.title},Texto.prototype.onPropertyChanged=function(t,e){this.widget.value=e},Texto.prototype.setValue=function(t){this.properties.texto=t},LiteGraph.registerNodeType("Constante/Texto",Texto),Condicional.title="Condicional",Condicional.desc="Crear una intersección del flujo principal del programa",Condicional.prototype.onAction=function(){var t=this.getInputData(1);!0===t?this.triggerSlot(0,"condicional verdadero"):!1===t&&this.triggerSlot(1,"condicional falso")},LiteGraph.registerNodeType("Control/Condicional",Condicional),Siempre.title="Siempre",Siempre.desc="Genera un flujo constante",Siempre.prototype.onExecute=function(){this.triggerSlot(0,"siempre")},LiteGraph.registerNodeType("Control/Siempre",Siempre),Comparar.title="Comparar",Comparar.desc="Compara dos valores y devuelve verdadero o falso",Comparar.prototype.onAction=function(){var t=this.getInputData(1),e=this.getInputData(2);void 0!==t&&void 0!==e?(this.setOutputData(1,t===e),this.triggerSlot(0,"comparar")):this.setOutputData(1,void 0)},LiteGraph.registerNodeType("Operación/Comparar",Comparar),Matematicas.title="Matemáticas",Matematicas.desc="Realiza la operación aritmética sobre dos valores",Matematicas.prototype.getTitle=function(){return this.flags.collapsed?this.op.value:this.title},Matematicas.prototype.onAction=function(){var t=this.getInputData(1),e=this.getInputData(2);if(void 0!==t&&void 0!==e&&t.constructor===Number&&e.constructor===Number){switch(this.op.value){case"+":this.setOutputData(1,t+e);break;case"-":this.setOutputData(1,t-e);break;case"*":this.setOutputData(1,t*e);break;case"/":this.setOutputData(1,t/e);break;case"%":this.setOutputData(1,t%e);break;case"^":this.setOutputData(1,Math.pow(t,e))}this.triggerSlot(0,"matematicas")}else this.setOutputData(1,void 0)},LiteGraph.registerNodeType("Operación/Matematicas",Matematicas),HeSidoHackeado.title="¿He sido hackeado?",HeSidoHackeado.desc="Comprueba si un email ha sido hackeado mediante HIBP",HeSidoHackeado.prototype.onAction=function(){var t=this.getInputData(1);void 0!==t&&(this.email_widget.value=t),void 0!==this.email_widget.value&&this.email_widget.value.constructor===String&&this.email_widget.value.includes("@")?this.checkEmail():(this.setOutputData(1,void 0),this.setOutputData(2,void 0))},HeSidoHackeado.prototype.checkEmail=function(){var e=this,i=!1,t=this.email_widget.value,n=new XMLHttpRequest;n.open("GET",this.API.concat(t),!0),n.onloadend=function(){if(4===n.readyState&&200===n.status){for(var t in accounts=[],data=JSON.parse(n.responseText),data)accounts.push(data[t].Name);response={result:!0,accounts:accounts},i=!0}else 404===n.status&&(response={result:!1,accounts:void 0},i=!0);i?(e.setOutputData(1,response.result),e.setOutputData(2,response.accounts),e.triggerSlot(0,"haveibeenopwned")):(e.setOutputData(1,void 0),e.setOutputData(2,void 0))},n.send(null)},LiteGraph.registerNodeType("API/¿He sido hackeado?",HeSidoHackeado),"undefined"!=typeof process&&void 0!==process.versions&&void 0!==process.versions.electron){var mongodb=require("mongojs");function MongoDB(){this.size=[60,20],this.uri_widget=this.addWidget("text","URI","",this.setURI.bind(this)),this.collection_widget=this.addWidget("text","Colección","",this.setCollection.bind(this)),this.document_widget=this.addWidget("number","Documento",0,this.setDocument.bind(this),{step:1,precision:0}),this.addWidget("button","Obtener",null,this.connectSocket.bind(this)),this.addInput("",LiteGraph.ACTION),this.addOutput("",LiteGraph.EVENT),this.addOutput("json",[]),this.properties={URI:"localhost:27017/db",coleccion:"coleccion",documento:0},this.db=null,this._error=!1}MongoDB.title="MongoDB",MongoDB.desc="Conexión a una MongoDB",MongoDB.prototype.connectSocket=function(){if(void 0===mongodb)return this._error||console.error("Mongojs no está instalado."),void(this._error=!0);var n=this;this.db=mongodb(this.properties.URI,[this.properties.coleccion]),this.db[this.properties.coleccion].find(function(t,e){var i=n.properties.documento;t||i>=e.length?n.setOutputData(1,[]):n.setOutputData(1,e[i])}),this.outputs[0]&&this.triggerSlot(0,"mongodb")},MongoDB.prototype.onAction=function(){this.connectSocket()},MongoDB.prototype.setURI=function(t){this.properties.URI=t,this.uri_widget.value=t},MongoDB.prototype.setCollection=function(t){this.properties.coleccion=t,this.collection_widget.value=t},MongoDB.prototype.setDocument=function(t){t=Math.round(t),this.properties.documento=t,this.document_widget.value=t},MongoDB.prototype.onPropertyChanged=function(t,e){"URI"==t?this.uri_widget.value=e:"coleccion"==t?this.collection_widget.value=e:"documento"==t&&(this.document_widget.value=Math.round(e))},LiteGraph.registerNodeType("Cliente/MongoDB",MongoDB)}var node_alfred=LiteGraph.createNode("Básico/Alfred");node_alfred.pos=[17,53],graph.add(node_alfred);